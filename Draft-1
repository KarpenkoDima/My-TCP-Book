# –ë–µ–∑–∂–∞–ª–æ—Å—Ç–Ω—ã–π –∞–Ω–∞–ª–∏–∑ TCP-–º–∞—Ç–µ—Ä–∏–∞–ª–∞

**Exported:** 2/8/2026 12:40:47  
**Link:** [https://gemini.google.com/app/fa6111d2171830aa?utm_source=app_launcher&utm_medium=owned&utm_campaign=base_all](https://gemini.google.com/app/fa6111d2171830aa?utm_source=app_launcher&utm_medium=owned&utm_campaign=base_all)

## Prompt:
> ExportBloc...dc7-Part-1 - –ü–∞–ø–∫–∞ —Å –∫–æ–¥–æ–º

–ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π —ç—Ç–æ—Ç –º–∞—Ç–µ—Ä–∏–∞–ª. –î–∞–π –±–µ–∑–∂–∞–ª–æ—Å—Ç–Ω—É—é –æ—Ü–µ–Ω–∫—É

## Response:
–í—ã –ø—Ä–æ—Å–∏–ª–∏ ¬´–±–µ–∑–∂–∞–ª–æ—Å—Ç–Ω—É—é¬ª –æ—Ü–µ–Ω–∫—É. –Ø –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–ª –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–π markdown-—Ñ–∞–π–ª, HTML-–≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—é –∏ –¥–∞–º–ø—ã Wireshark.

–ù–∏–∂–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω —Ä–∞–∑–±–æ—Ä –º–∞—Ç–µ—Ä–∏–∞–ª–∞: –æ—Ç –∫–æ–Ω—Ü–µ–ø—Ç—É–∞–ª—å–Ω—ã—Ö –æ—à–∏–±–æ–∫ –¥–æ –ø–µ–¥–∞–≥–æ–≥–∏—á–µ—Å–∫–∏—Ö —É–¥–∞—á.

### –û–±—â–∏–π –≤–µ—Ä–¥–∏–∫—Ç

–≠—Ç–æ **–æ—Ç–ª–∏—á–Ω–æ–µ –ø–æ—Å–æ–±–∏–µ –¥–ª—è –ø—Ä–∏–∫–ª–∞–¥–Ω—ã—Ö —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤** (Backend, GameDev), –∫–æ—Ç–æ—Ä—ã–µ —Ö–æ—Ç—è—Ç –ø–æ–Ω—è—Ç—å, –ø–æ—á–µ–º—É –∏—Ö —Å–µ—Ç—å ¬´—Ç—É–ø–∏—Ç¬ª, –Ω–æ —ç—Ç–æ **—Å–ª–∞–±—ã–π –º–∞—Ç–µ—Ä–∏–∞–ª –¥–ª—è —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç–æ–≤**, –ø–∏—à—É—â–∏—Ö —Å–µ—Ç–µ–≤—ã–µ –¥—Ä–∞–π–≤–µ—Ä—ã –∏–ª–∏ –≤—ã—Å–æ–∫–æ–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–∫—Å–∏.

–ú–∞—Ç–µ—Ä–∏–∞–ª —Å—Ç—Ä–∞–¥–∞–µ—Ç –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–æ–π –±–æ–ª–µ–∑–Ω—å—é ¬´–∞–∫–∞–¥–µ–º–∏—á–µ—Å–∫–æ–≥–æ —É–ø—Ä–æ—â–µ–Ω–∏—è¬ª: –æ–Ω –æ–±—ä—è—Å–Ω—è–µ—Ç TCP —Ç–∞–∫, –∫–∞–∫ –µ–≥–æ –ø—Ä–µ–ø–æ–¥–∞–≤–∞–ª–∏ –≤ 2000-—Ö, –Ω–∞–∫–ª–∞–¥—ã–≤–∞—è —Å–≤–µ—Ä—Ö—É —Å–∏–Ω—Ç–∞–∫—Å–∏—Å C# –∏ Python, —á—Ç–æ —Å–æ–∑–¥–∞–µ—Ç –∏–ª–ª—é–∑–∏—é –ø—Ä–æ—Å—Ç–æ—Ç—ã, –∫–æ—Ç–æ—Ä–æ–π –≤ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ –Ω–µ—Ç.

* * *

### 1\. –ö–æ–Ω—Ü–µ–ø—Ç—É–∞–ª—å–Ω—ã–µ –ø—Ä–µ—Ç–µ–Ω–∑–∏–∏ (–ì–¥–µ –º–∞—Ç–µ—Ä–∏–∞–ª –≤–≤–æ–¥–∏—Ç –≤ –∑–∞–±–ª—É–∂–¥–µ–Ω–∏–µ)

#### C# –∫–∞–∫ —è–∑—ã–∫ –¥–ª—è –æ–±—ä—è—Å–Ω–µ–Ω–∏—è TCP

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ C# –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ ¬´–ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã¬ª (–∫–∞–∫ —Å–∫–∞–∑–∞–Ω–æ –≤ –Ω–∞—á–∞–ª–µ) ‚Äî —ç—Ç–æ –Ω–∞—Ç—è–≥–∏–≤–∞–Ω–∏–µ —Å–æ–≤—ã –Ω–∞ –≥–ª–æ–±—É—Å.

*   **–†–µ–∞–ª—å–Ω–æ—Å—Ç—å:** TCP-—Å—Ç–µ–∫–∏ –≤ 99.9% —Å–ª—É—á–∞–µ–≤ –Ω–∞–ø–∏—Å–∞–Ω—ã –Ω–∞ C (Linux kernel, Windows kernel, FreeBSD). –î–∞–∂–µ user-space —Å—Ç–µ–∫–∏ (—Ç–∏–ø–∞ VPP –∏–ª–∏ DPDK) –ø–∏—à—É—Ç –Ω–∞ C/C++ –∏–ª–∏ Rust.
*   **–ü—Ä–æ–±–ª–µ–º–∞ –ø—Ä–∏–º–µ—Ä–∞:** –ö–æ–¥ –Ω–∞ C# –≤ –ø—Ä–∏–º–µ—Ä–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –≤—ã—Å–æ–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–µ –æ–±—ä–µ–∫—Ç—ã –∏ `List<T>`, —á—Ç–æ –∫–∞—Ç–∞—Å—Ç—Ä–æ—Ñ–∏—á–µ—Å–∫–∏ –Ω–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–∞–∫–µ—Ç–æ–≤. –ï—Å–ª–∏ –Ω–æ–≤–∏—á–æ–∫ –ø–æ–ø—ã—Ç–∞–µ—Ç—Å—è –Ω–∞–ø–∏—Å–∞—Ç—å ¬´—Å–≤–æ–π –Ω–∞–¥–µ–∂–Ω—ã–π UDP¬ª (–∫–∞–∫ –≤ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –ê) –ø–æ —ç—Ç–∏–º –ø–∞—Ç—Ç–µ—Ä–Ω–∞–º, –æ–Ω –ø–æ–ª—É—á–∏—Ç Garbage Collection –ø–∞—É–∑—ã, —É–±–∏–≤–∞—é—â–∏–µ –≤–µ—Å—å —Å–º—ã—Å–ª Real-Time –ø—Ä–æ—Ç–æ–∫–æ–ª–∞.
*   **–í–µ—Ä–¥–∏–∫—Ç:** –ü—Ä–∏–º–µ—Ä –Ω–∞ C# –ø–æ–ª–µ–∑–µ–Ω —Ç–æ–ª—å–∫–æ –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è _–ª–æ–≥–∏–∫–∏_, –Ω–æ –≤—Ä–µ–¥–µ–Ω –∫–∞–∫ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π —Ä–µ—Ñ–µ—Ä–µ–Ω—Å.

#### –°–º–µ—à–µ–Ω–∏–µ –ë–∞–π—Ç–æ–≤ –∏ –°–µ–≥–º–µ–Ω—Ç–æ–≤ (MSS)

–ê–≤—Ç–æ—Ä –ø—ã—Ç–∞–µ—Ç—Å—è –æ–±—ä—è—Å–Ω–∏—Ç—å –ø—É—Ç–∞–Ω–∏—Ü—É –º–µ–∂–¥—É –±–∞–π—Ç–∞–º–∏ –∏ —Å–µ–≥–º–µ–Ω—Ç–∞–º–∏ (–≤—Ä–µ–∑–∫–∞ `üí° –ü–æ—è—Å–Ω–µ–Ω–∏—è`), –Ω–æ —Å–∞–º –∂–µ –≤ –Ω–µ–π –≤—è–∑–Ω–µ—Ç.

*   –í –∫–æ–¥–µ Python `cwnd` —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è –Ω–∞ `MSS` (–±–∞–π—Ç—ã), –Ω–æ –ª–æ–≥–∏–∫–∞ –ø—Ä–æ–≤–µ—Ä–æ–∫ —á–∞—Å—Ç–æ –≤—ã–≥–ª—è–¥–∏—Ç –∫–∞–∫ –ø–æ–¥—Å—á–µ—Ç –ø–∞–∫–µ—Ç–æ–≤.
*   –§–æ—Ä–º—É–ª–∞ `cwnd += MSS * MSS / cwnd` (–¥–ª—è Congestion Avoidance) –≤–µ—Ä–Ω–∞ –¥–ª—è –±–∞–π—Ç–æ–≤–æ–≥–æ –∏—Å—á–∏—Å–ª–µ–Ω–∏—è, –Ω–æ –≤ —Ç–µ–∫—Å—Ç–µ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –∏–¥–µ—Ç –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞: ¬´–æ–∫–Ω–æ 10 –ø–∞–∫–µ—Ç–æ–≤¬ª vs ¬´–æ–∫–Ω–æ 14600 –±–∞–π—Ç¬ª. –≠—Ç–æ —Å–∞–º–∞—è —á–∞—Å—Ç–∞—è –ø—Ä–∏—á–∏–Ω–∞ –±–∞–≥–æ–≤ —É –Ω–æ–≤–∏—á–∫–æ–≤, –∏ –º–∞—Ç–µ—Ä–∏–∞–ª –Ω–µ —É—Å—Ç—Ä–∞–Ω—è–µ—Ç —ç—Ç—É –ø—É—Ç–∞–Ω–∏—Ü—É –¥–æ –∫–æ–Ω—Ü–∞.

#### –£—Å—Ç–∞—Ä–µ–≤—à–∞—è ¬´–ù–æ—Ä–º–∞¬ª (Reno/NewReno vs CUBIC/BBR)

–ú–∞—Ç–µ—Ä–∏–∞–ª 80% –≤—Ä–µ–º–µ–Ω–∏ —Ç—Ä–∞—Ç–∏—Ç –Ω–∞ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ TCP Reno –∏ NewReno.

*   **–ñ–µ—Å—Ç–∫–∞—è –ø—Ä–∞–≤–¥–∞:** –í Linux –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **CUBIC** —É–∂–µ –º–Ω–æ–≥–æ –ª–µ—Ç, –∞ Google –∏ Cloudflare –∂–∏–≤—É—Ç –Ω–∞ **BBR**.
*   –†–∞–∑–¥–µ–ª –ø—Ä–æ CUBIC –∏ BBR —Å–ª–∏—à–∫–æ–º –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–Ω—ã–π. –°–∫–∞–∑–∞—Ç—å, —á—Ç–æ BBR ¬´—É–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏–∑–º–µ—Ä–µ–Ω–∏–π¬ª ‚Äî –º–∞–ª–æ. –ù—É–∂–Ω–æ –æ–±—ä—è—Å–Ω–∏—Ç—å, —á—Ç–æ BBR _–∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç_ –ø–æ—Ç–µ—Ä–∏ –ø–∞–∫–µ—Ç–æ–≤ –∫–∞–∫ —Å–∏–≥–Ω–∞–ª –æ –ø–µ—Ä–µ–≥—Ä—É–∑–∫–µ (–¥–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–≥–æ –ø—Ä–µ–¥–µ–ª–∞), —á—Ç–æ —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω–æ –º–µ–Ω—è–µ—Ç –≤—Å–µ –ø—Ä–∞–≤–∏–ª–∞ –∏–≥—Ä—ã, –æ–ø–∏—Å–∞–Ω–Ω—ã–µ –≤ –ø–µ—Ä–≤—ã—Ö –≥–ª–∞–≤–∞—Ö. –û–±—É—á–∞—è –ª—é–¥–µ–π –Ω–∞ Reno, –º—ã –≥–æ—Ç–æ–≤–∏–º –∏—Ö –∫ –ø—Ä–æ—à–ª–æ–º—É.

* * *

### 2\. –ê–Ω–∞–ª–∏–∑ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–≥–æ –∫–µ–π—Å–∞ (Wireshark) ‚Äî –°–∞–º–∞—è —Å–∏–ª—å–Ω–∞—è —á–∞—Å—Ç—å

–†–∞–∑–¥–µ–ª ¬´–ê–Ω–∞–ª–∏–∑ —Ä–µ–∞–ª—å–Ω–æ–≥–æ TCP-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è¬ª ‚Äî —ç—Ç–æ **–±—Ä–∏–ª–ª–∏–∞–Ω—Ç** –≤ —ç—Ç–æ–º –¥–æ–∫—É–º–µ–Ω—Ç–µ.

*   **–ë–µ–∑–∂–∞–ª–æ—Å—Ç–Ω–∞—è –ø—Ä–∞–≤–¥–∞:** –ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –∫—É—Ä—Å–æ–≤ —É—á–∞—Ç –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å `sysctl`, –Ω–æ —ç—Ç–æ—Ç –º–∞—Ç–µ—Ä–∏–∞–ª –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–µ–∞–ª—å–Ω–æ—Å—Ç—å: **–ø—Ä–æ–±–ª–µ–º–∞ –Ω–µ –≤ —Å–µ—Ç–∏, –∞ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏.**
*   –ê–Ω–∞–ª–∏–∑ –≥—Ä–∞—Ñ–∏–∫–∞ `Window Scaling` –∏ –≤—ã–≤–æ–¥ –æ —Ç–æ–º, —á—Ç–æ –ø–µ—Ä–µ–¥–∞—á–∞ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∞ –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–º (`rwnd ~500 –±–∞–π—Ç`), –∞ –Ω–µ —Å–µ—Ç—å—é ‚Äî —ç—Ç–æ —Ç–æ, —á–µ–≥–æ –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç –≤ 90% —Ç—É—Ç–æ—Ä–∏–∞–ª–æ–≤.
*   **–ü–ª—é—Å:** –ê–≤—Ç–æ—Ä –≤–µ—Ä–Ω–æ –∑–∞–º–µ—Ç–∏–ª `Application-Limited` –ø–æ–≤–µ–¥–µ–Ω–∏–µ (–ø–∞—É–∑—ã –º–µ–∂–¥—É –æ—Ç–ø—Ä–∞–≤–∫–æ–π –¥–∞–Ω–Ω—ã—Ö). –≠—Ç–æ —É—á–∏—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞—Ç—å —Å–≤–æ–π –∫–æ–¥, –∞ –Ω–µ –≤–∏–Ω–∏—Ç—å –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞.
*   **–ú–∏–Ω—É—Å:** –ê–Ω–∞–ª–∏–∑ –º–æ–≥ –±—ã—Ç—å –≥–ª—É–±–∂–µ. –ü–æ—á–µ–º—É `rwnd` 500 –±–∞–π—Ç? –≠—Ç–æ –ø–æ—Ö–æ–∂–µ –Ω–∞ –∫–∞–∫–æ–π-—Ç–æ IoT –ø—Ä–∏–Ω—Ç–µ—Ä –∏–ª–∏ –æ—á–µ–Ω—å —Å—Ç–∞—Ä—ã–π embedded-–¥–µ–≤–∞–π—Å. –í —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –û–° (Windows/Linux) –æ–∫–Ω–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –±—É–¥–µ—Ç —Ç–∞–∫–∏–º –º–∞–ª–µ–Ω—å–∫–∏–º –±–µ–∑ –∂–µ—Å—Ç–∫–æ–≥–æ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –≤ —Å–æ–∫–µ—Ç–µ.

* * *

### 3\. –û—Ü–µ–Ω–∫–∞ –∫–æ–¥–∞ –∏ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏

#### –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è (HTML)

–§–∞–π–ª `TCP_SACK_vs_Regular_ACK.html` ‚Äî —Ö–æ—Ä–æ—à–∞—è, –ø—Ä–æ—Å—Ç–∞—è –∏–≥—Ä—É—à–∫–∞.

*   **–ü–ª—é—Å:** –ù–∞–≥–ª—è–¥–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–∞–∑–Ω–∏—Ü—É –≤ –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ —Ä–µ—Ç—Ä–∞–Ω—Å–º–∏—Ç–æ–≤.
*   **–ú–∏–Ω—É—Å:** –û–Ω–∞ —Å—Ç–µ—Ä–∏–ª—å–Ω–∞. –í —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ SACK-–±–ª–æ–∫–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω—ã (–æ–±—ã—á–Ω–æ 3-4 –±–ª–æ–∫–∞), –∞ "–¥—ã—Ä—ã" –º–æ–≥—É—Ç –±—ã—Ç—å —Å–ª–æ–∂–Ω—ã–º–∏. –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç, —á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Å `cwnd` –≤–æ –≤—Ä–µ–º—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è.

#### –ü—Ä–∏–º–µ—Ä ¬´Reliable UDP¬ª (–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ê)

–≠—Ç–æ **—Å–∞–º–∞—è –æ–ø–∞—Å–Ω–∞—è —á–∞—Å—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞**.

*   –ù–∞–ø–∏—Å–∞—Ç—å: `// –í–∞–º –ø—Ä–∏–¥–µ—Ç—Å—è —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–≤–æ–π –∞–Ω–∞–ª–æ–≥ Slow Start` ‚Äî —ç—Ç–æ –∫–∞–∫ —Å–∫–∞–∑–∞—Ç—å ¬´–Ω–∞—Ä–∏—Å—É–π—Ç–µ –æ—Å—Ç–∞–ª—å–Ω—É—é —á–∞—Å—Ç—å —Å–æ–≤—ã¬ª.
*   –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞–¥–µ–∂–Ω–æ–≥–æ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞ –ø–æ–≤–µ—Ä—Ö UDP ‚Äî —ç—Ç–æ —Å–ª–æ–∂–Ω–µ–π—à–∞—è –∏–Ω–∂–µ–Ω–µ—Ä–Ω–∞—è –∑–∞–¥–∞—á–∞ (—Å–º. –º—É—á–µ–Ω–∏—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ QUIC). –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω—ã–π –∫–æ–¥ `CustomReliableUdp` —Å–æ–∑–¥–∞–µ—Ç –ª–æ–∂–Ω–æ–µ –æ—â—É—â–µ–Ω–∏–µ, —á—Ç–æ —ç—Ç–æ –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –∑–∞ –≤—ã—Ö–æ–¥–Ω—ã–µ, –∏—Å–ø–æ–ª—å–∑—É—è `Task.Run` –∏ —Å–ª–æ–≤–∞—Ä–∏.
*   **–°–æ–≤–µ—Ç:** –≠—Ç–æ—Ç —Ä–∞–∑–¥–µ–ª –Ω—É–∂–Ω–æ –ª–∏–±–æ —Å–Ω–∞–±–¥–∏—Ç—å –æ–≥—Ä–æ–º–Ω—ã–º –¥–∏—Å–∫–ª–µ–π–º–µ—Ä–æ–º ¬´–ù–ï –î–ï–õ–ê–ô–¢–ï –≠–¢–û –í –ü–†–û–î–ê–ö–®–ï–ù–ï¬ª, –ª–∏–±–æ —É–±—Ä–∞—Ç—å.

* * *

### 4\. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏ –ø–æ–¥–∞—á–∞

*   **–û–≥–ª–∞–≤–ª–µ–Ω–∏–µ –∏ –Ω–∞–≤–∏–≥–∞—Ü–∏—è:** –•–æ—Ä–æ—à–∏–µ. –†–∞–∑–±–∏–µ–Ω–∏–µ –Ω–∞ —à–∞–≥–∏ –ª–æ–≥–∏—á–Ω–æ–µ.
*   **–°—Ç–∏–ª—å:** –ú–µ—Å—Ç–∞–º–∏ —Å–ª–∏—à–∫–æ–º –≤–æ—Å—Ç–æ—Ä–∂–µ–Ω–Ω—ã–π (¬´–∏–Ω–∂–µ–Ω–µ—Ä–Ω–æ–µ —á—É–¥–æ¬ª, ¬´—ç–ª–µ–≥–∞–Ω—Ç–Ω–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ¬ª). –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Å—É—à–µ.
*   **–û–ø–µ—á–∞—Ç–∫–∏:** –í—Å—Ç—Ä–µ—á–∞—é—Ç—Å—è –¥—É–±–ª–∏—Ä—É—é—â–∏–µ—Å—è –∫—É—Å–∫–∏ —Ç–µ–∫—Å—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ –æ–±—ä—è—Å–Ω–µ–Ω–∏–∏ –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –º–æ–¥–µ–ª–∏ Slow Start —Ç–µ–∫—Å—Ç –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è –¥–≤–∞–∂–¥—ã).

### –ò—Ç–æ–≥–æ–≤–∞—è –æ—Ü–µ–Ω–∫–∞: 7/10

**–ö–æ–º—É —á–∏—Ç–∞—Ç—å:**

*   Junior/Middle —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞–º, –∫–æ—Ç–æ—Ä—ã–µ –¥—É–º–∞—é—Ç, —á—Ç–æ TCP ‚Äî —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ ¬´–≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞¬ª.
*   –¢–µ–º, –∫—Ç–æ —Ö–æ—á–µ—Ç –Ω–∞—É—á–∏—Ç—å—Å—è –±–∞–∑–æ–≤–æ–º—É –∞–Ω–∞–ª–∏–∑—É .pcap —Ñ–∞–π–ª–æ–≤ (—Ä–∞–∑–¥–µ–ª –ø—Ä–æ Wireshark –æ—Ç–ª–∏—á–Ω—ã–π).

**–ö–æ–º—É –≤—ã–±—Ä–æ—Å–∏—Ç—å:**

*   –°–µ—Ç–µ–≤—ã–º –∏–Ω–∂–µ–Ω–µ—Ä–∞–º, –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—é—â–∏–º BGP/MPLS.
*   –†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞–º High-Load —Å–∏—Å—Ç–µ–º, –∫–æ—Ç–æ—Ä—ã–º –Ω—É–∂–Ω–æ –≤—ã–∂–∞—Ç—å 100Gbps (–∫–æ–¥ –Ω–∞ C# —Ç—É—Ç –≤—ã–∑–æ–≤–µ—Ç —Å–º–µ—Ö).

**–ì–ª–∞–≤–Ω—ã–π –≤—ã–≤–æ–¥:** –ú–∞—Ç–µ—Ä–∏–∞–ª —Ö–æ—Ä–æ—à —Ç–µ–º, —á—Ç–æ –æ–Ω _–µ—Å—Ç—å_ –∏ –æ–Ω –ø—ã—Ç–∞–µ—Ç—Å—è —Å–≤—è–∑–∞—Ç—å —Ç–µ–æ—Ä–∏—é —Å –ø—Ä–∞–∫—Ç–∏–∫–æ–π. –ù–æ –æ–Ω –∑–∞—Å—Ç—Ä—è–ª –º–µ–∂–¥—É —É—á–µ–±–Ω–∏–∫–æ–º –¥–ª—è –≤—É–∑–∞ (—Ç–µ–æ—Ä–∏—è 90-—Ö) –∏ –±–ª–æ–≥–æ–º –Ω–∞ –•–∞–±—Ä–µ (–ø—Ä–∞–∫—Ç–∏–∫–∞ Wireshark), –Ω–µ –¥–æ—Ç—è–≥–∏–≤–∞—è –¥–æ —Å–µ—Ä—å–µ–∑–Ω–æ–≥–æ –∏–Ω–∂–µ–Ω–µ—Ä–Ω–æ–≥–æ –≥–∞–π–¥–∞ –∏–∑-–∑–∞ –≤—ã–±–æ—Ä–∞ —è–∑—ã–∫–∞ –∏ —É–ø—Ä–æ—â–µ–Ω–∏–π.

## Prompt:
–î–∞–≤–∞–π –æ–±—Ä–∏—Å—É–µ–º –º–∞—Ç–µ—Ä–∏–∞–ª –¥–ª—è –Ω–∞—Å—Ç–æ—è—â–∏—Ö –ø—Ä–æ—Ñ–∏

## Response:
–†–∞–∑ —É–∂ –º—ã –¥–æ–≥–æ–≤–æ—Ä–∏–ª–∏—Å—å –ø–æ–≤—ã—à–∞—Ç—å –ø–ª–∞–Ω–∫—É –∏ –¥–µ–ª–∞—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª –¥–ª—è **–Ω–∞—Å—Ç–æ—è—â–∏—Ö** –∏–Ω–∂–µ–Ω–µ—Ä–æ–≤ (High-Load –∞—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä–æ–≤, —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –¥—Ä–∞–π–≤–µ—Ä–æ–≤, SRE), –¥–∞–≤–∞–π –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–∫—Ä–æ–∏–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É.

–í–º–µ—Å—Ç–æ ¬´—à–∫–æ–ª—å–Ω–æ–≥–æ¬ª –æ–±—ä—è—Å–Ω–µ–Ω–∏—è –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤ 80-—Ö –≥–æ–¥–æ–≤, –º—ã —Å–æ—Å—Ä–µ–¥–æ—Ç–æ—á–∏–º—Å—è –Ω–∞ —Ç–æ–º, –∫–∞–∫ —Å–µ—Ç—å —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ Linux Kernel, –∂–µ–ª–µ–∑–µ –∏ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö High-Perf –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è—Ö. –ù–∏–∫–∞–∫–∏—Ö –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–π ‚Äî —Ç–æ–ª—å–∫–æ ¬´–∂–µ–ª–µ–∑–æ¬ª, —è–¥—Ä–æ –∏ –±–∞–π—Ç—ã.

–í–æ—Ç –∫–∞–∫ –¥–æ–ª–∂–µ–Ω –≤—ã–≥–ª—è–¥–µ—Ç—å **Syllabus (–£—á–µ–±–Ω—ã–π –ø–ª–∞–Ω) —É—Ä–æ–≤–Ω—è Senior/Principal Engineer**:

* * *

### –ú–æ–¥—É–ª—å 1: –§–∏–∑–∏–∫–∞ –∏ –Ø–¥—Ä–æ (–ì–¥–µ —Ä–µ–∞–ª—å–Ω–æ —É–º–∏—Ä–∞—é—Ç –ø–∞–∫–µ—Ç—ã)

_–í–º–µ—Å—Ç–æ –≤–≤–µ–¥–µ–Ω–∏—è –ø—Ä–æ ¬´–∏–Ω–∂–µ–Ω–µ—Ä–Ω–æ–µ —á—É–¥–æ¬ª ‚Äî —Å—É—Ä–æ–≤–∞—è –ø—Ä–∞–≤–¥–∞ –æ –ø—É—Ç–∏ –ø–∞–∫–µ—Ç–∞._

1.  **–ü—É—Ç—å –ø–∞–∫–µ—Ç–∞ (The Life of a Packet):**
    *   –û—Ç –ø—Ä–æ–≤–æ–¥–∞ –¥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è: DMA, Ring Buffers, Hard IRQ, SoftIRQ, NAPI (New API).
    *   –ü–æ—á–µ–º—É `ksoftirqd` –≥—Ä—É–∑–∏—Ç CPU –≤ –ø–æ–ª–∫—É –Ω–∞ –æ–¥–Ω–æ–º —è–¥—Ä–µ –∏ –∫–∞–∫ —Å —ç—Ç–∏–º –±–æ—Ä–æ—Ç—å—Å—è (RPS/RFS/XPS).
    *   –°—Ç—Ä—É–∫—Ç—É—Ä–∞ `sk_buff` –≤ Linux: —Ü–µ–Ω–∞ –∞–ª–ª–æ–∫–∞—Ü–∏–π –∏ –ø–æ—á–µ–º—É –º—ã –±–æ—Ä–µ–º—Å—è –∑–∞ –∫–∞–∂–¥—ã–π cache-line.
2.  **Offloading ‚Äî –∫–∞–∫ –∂–µ–ª–µ–∑–æ –¥–µ–ª–∞–µ—Ç —Ä–∞–±–æ—Ç—É –∑–∞ –Ω–∞—Å:**
    *   **TSO/GSO (Segmentation Offload):** –ü–æ—á–µ–º—É –≤ Wireshark –º—ã –≤–∏–¥–∏–º –ø–∞–∫–µ—Ç—ã –ø–æ 64–ö–ë, —Ö–æ—Ç—è MTU 1500.
    *   **LRO/GRO (Receive Offload):** –ê–≥—Ä–µ–≥–∞—Ü–∏—è –≤—Ö–æ–¥—è—â–∏—Ö –ø–∞–∫–µ—Ç–æ–≤. –û–ø–∞—Å–Ω–æ—Å—Ç–∏ LRO –¥–ª—è —Ä–æ—É—Ç–∏–Ω–≥–∞/–±—Ä–∏–¥–∂–∏–Ω–≥–∞.
    *   **Checksum Offload:** –ü–æ—á–µ–º—É –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–µ —Å—É–º–º—ã –≤ –¥–∞–º–ø–∞—Ö —á–∞—Å—Ç–æ –Ω–µ–≤–µ—Ä–Ω—ã.
3.  **Kernel Bypass (–ö–æ–≥–¥–∞ —è–¥—Ä–æ —Å–ª–∏—à–∫–æ–º –º–µ–¥–ª–µ–Ω–Ω–æ–µ):**
    *   –ü—Ä–æ–±–ª–µ–º–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –∏ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –ø–∞–º—è—Ç–∏ (`copy_to_user`).
    *   **DPDK (Data Plane Development Kit):** Polling mode drivers, hugepages, NUMA-awareness.
    *   **XDP (eXpress Data Path) & eBPF:** –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∏ –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–∞–∫–µ—Ç–æ–≤ –Ω–∞ —É—Ä–æ–≤–Ω–µ –¥—Ä–∞–π–≤–µ—Ä–∞ —Å–µ—Ç–µ–≤–æ–π –∫–∞—Ä—Ç—ã –±–µ–∑ –ø–æ–¥—ä–µ–º–∞ –≤ —Å—Ç–µ–∫ —è–¥—Ä–∞.

### –ú–æ–¥—É–ª—å 2: –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π Congestion Control (–ó–∞–±—É–¥—å—Ç–µ –ø—Ä–æ Reno)

_Reno/NewReno –æ—Å—Ç–∞–≤–∏–º –∏—Å—Ç–æ—Ä–∏–∫–∞–º. –ì–æ–≤–æ—Ä–∏–º –æ —Ç–æ–º, —á—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ Cloudflare –∏ Google._

1.  **CUBIC (–î–µ-—Ñ–∞–∫—Ç–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç):**
    *   –ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞ –∫—É–±–∏—á–µ—Å–∫–æ–π —Ñ—É–Ω–∫—Ü–∏–∏: –ø–æ—á–µ–º—É –æ–Ω–∞ –ª—É—á—à–µ –ª–∏–Ω–µ–π–Ω–æ–≥–æ —Ä–æ—Å—Ç–∞ –Ω–∞ –¥–ª–∏–Ω–Ω—ã—Ö —Ç–æ–ª—Å—Ç—ã—Ö –∫–∞–Ω–∞–ª–∞—Ö (LFN).
    *   `HyStart`: –ö–∞–∫ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ç–æ—á–∫—É –≤—ã—Ö–æ–¥–∞ –∏–∑ Slow Start –±–µ–∑ –ø–æ—Ç–µ—Ä—å (–ø–æ –∑–∞–¥–µ—Ä–∂–∫–∞–º).
2.  **BBR (Bottleneck Bandwidth and Round-trip propagation time):**
    *   –°–º–µ–Ω–∞ –ø–∞—Ä–∞–¥–∏–≥–º—ã: –æ—Ç–∫–∞–∑ –æ—Ç Loss-based –≤ –ø–æ–ª—å–∑—É Model-based.
    *   –ü–æ–Ω—è—Ç–∏–µ BDP (Bandwidth-Delay Product) –∫–∞–∫ —Ü–µ–ª–µ–≤–æ–≥–æ –æ–±—ä–µ–º–∞ –¥–∞–Ω–Ω—ã—Ö –≤ –ø–æ–ª–µ—Ç–µ.
    *   **BBR pacing:** –ü–æ—á–µ–º—É BBR –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø–∞–∫–µ—Ç—ã —Å –∏–¥–µ–∞–ª—å–Ω–æ —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–Ω—ã–º–∏ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞–º–∏, –∞ –Ω–µ –ø–∞—á–∫–∞–º–∏ (bursts).
    *   –ü—Ä–æ–±–ª–µ–º–∞ ¬´–Ω–µ—Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ—Å—Ç–∏¬ª BBR v1 –∫ CUBIC –∏ –∫–∞–∫ BBR v3 —ç—Ç–æ —Ä–µ—à–∞–µ—Ç.
3.  **DCTCP & ECN (Data Center TCP):**
    *   –ü—Ä–æ–±–ª–µ–º—ã Incast –≤ –¥–∞—Ç–∞-—Ü–µ–Ω—Ç—Ä–∞—Ö.
    *   –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ ECN (Explicit Congestion Notification) –≤–º–µ—Å—Ç–æ –¥—Ä–æ–ø–æ–≤ –ø–∞–∫–µ—Ç–æ–≤.
    *   –ú–≥–Ω–æ–≤–µ–Ω–Ω–∞—è —Ä–µ–∞–∫—Ü–∏—è –Ω–∞ —Ä–æ—Å—Ç –æ—á–µ—Ä–µ–¥–∏ —Å–≤–∏—Ç—á–∞ (RED/AQM).

### –ú–æ–¥—É–ª—å 3: –¢—é–Ω–∏–Ω–≥ –∏ –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ (–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞—Ä–∏–π –ü—Ä–æ—Ñ–∏)

_–û—Ç–∫–ª–∞–¥—ã–≤–∞–µ–º Wireshark –¥–ª—è –ø—Ä–æ—Å—Ç—ã—Ö —Å–ª—É—á–∞–µ–≤. –î–æ—Å—Ç–∞–µ–º —Ç—è–∂–µ–ª—É—é –∞—Ä—Ç–∏–ª–ª–µ—Ä–∏—é._

1.  **–ì–ª—É–±–æ–∫–∏–π –∞–Ω–∞–ª–∏–∑ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:**
    *   **Microbursts:** –ü–æ—á–µ–º—É —Å–µ–∫—É–Ω–¥–Ω—ã–µ –≥—Ä–∞—Ñ–∏–∫–∏ –≤—Ä—É—Ç. –ö–∞–∫ –ª–æ–≤–∏—Ç—å –º–∏–∫—Ä–æ-–≤—Å–ø–ª–µ—Å–∫–∏, –ø–µ—Ä–µ–ø–æ–ª–Ω—è—é—â–∏–µ –±—É—Ñ–µ—Ä—ã –∑–∞ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥—ã.
    *   **Bufferbloat:** –ö–∞–∫ –±–æ–ª—å—à–∏–µ –±—É—Ñ–µ—Ä—ã —É–±–∏–≤–∞—é—Ç –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å.
    *   –†–µ—à–µ–Ω–∏–µ: –ê–ª–≥–æ—Ä–∏—Ç–º—ã –æ—á–µ—Ä–µ–¥–µ–π **FQ\_CoDel** –∏ **CAKE**. –ü–æ—á–µ–º—É `pfifo_fast` ‚Äî —ç—Ç–æ –∑–ª–æ.
2.  **–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –Ω–∞–±–ª—é–¥–µ–Ω–∏—è (Observability):**
    *   `ss` (socket statistics) —Å —Ñ–ª–∞–≥–∞–º–∏ `-ti`: –†–∞–∑–±–æ—Ä –ø–æ–ª–µ–π `unacked`, `retrans`, `rtt`, `rcv_space`.
    *   `tc` (Traffic Control): –≠–º—É–ª—è—Ü–∏—è –∑–∞–¥–µ—Ä–∂–µ–∫, –ø–æ—Ç–µ—Ä—å –∏ –ø–µ—Ä–µ—É–ø–æ—Ä—è–¥–æ—á–∏–≤–∞–Ω–∏—è –¥–ª—è Chaos Engineering.
    *   **eBPF Tracing (bpftrace/bcc):** –ö–∞–∫ –∑–∞–ª–µ–∑—Ç—å –≤–Ω—É—Ç—Ä—å —Ñ—É–Ω–∫—Ü–∏–∏ `tcp_rcv_established` –≤ —è–¥—Ä–µ –∏ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º—É –∑–∞–¥–µ—Ä–∂–µ–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∏ ACK –±–µ–∑ –æ–≤–µ—Ä—Ö–µ–¥–∞.
3.  **–°–∏—Å—Ç–µ–º–Ω—ã–π —Ç—é–Ω–∏–Ω–≥ (`sysctl.conf`):**
    *   –ü–æ—á–µ–º—É –∫–æ–ø–∏–ø–∞—Å—Ç –∫–æ–Ω—Ñ–∏–≥–æ–≤ –∏–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞ –≤—Ä–µ–¥–µ–Ω.
    *   –†–∞—Å—á–µ—Ç `tcp_mem`, `tcp_rmem`, `tcp_wmem` –ø–æ–¥ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π BDP –∏ –æ–±—ä–µ–º RAM.
    *   `tcp_tw_reuse` vs `tcp_tw_recycle` (–∏ –ø–æ—á–µ–º—É –ø–æ—Å–ª–µ–¥–Ω–∏–π —É–¥–∞–ª–µ–Ω –∏–∑ —è–¥—Ä–∞).
    *   –û–ø–∞—Å–Ω–æ—Å—Ç–∏ `tcp_timestamps` –∑–∞ NAT-–æ–º.

### –ú–æ–¥—É–ª—å 4: –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π (–ü–∏—à–µ–º –∫–æ–¥, –∫–æ—Ç–æ—Ä—ã–π –ª–µ—Ç–∞–µ—Ç)

_–ï—Å–ª–∏ –≤—ã –≤—Å—ë –∂–µ –ø–∏—à–µ—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, –∞ –Ω–µ –¥—Ä–∞–π–≤–µ—Ä, –∫–∞–∫ –Ω–µ —É–±–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å._

1.  **Zero-Copy —Ç–µ—Ö–Ω–∏–∫–∏:**
    *   `sendfile` –∏ `splice`: –ø–µ—Ä–µ–∫–ª–∞–¥—ã–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ —Ñ–∞–π–ª–∞ –≤ —Å–æ–∫–µ—Ç –±–µ–∑ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –≤ user-space.
    *   `MSG_ZEROCOPY` –≤ Linux.
2.  **IO Models:**
    *   Blocking vs Non-blocking vs Multiplexing (`epoll`/`kqueue`).
    *   **io\_uring:** –ù–æ–≤–∞—è —ç—Ä–∞ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç–∏ –≤ Linux. Submission/Completion queues.
3.  **–ü—Ä–∏–∫–ª–∞–¥–Ω–æ–π —É—Ä–æ–≤–µ–Ω—å (C# Context, —Ä–∞–∑ —É–∂ —Ç—ã C#-—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫):**
    *   –ó–∞–±—ã–≤–∞–µ–º –ø—Ä–æ –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–µ `Socket` –∏ `Stream`.
    *   **System.IO.Pipelines:** –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±—É—Ñ–µ—Ä–∞–º–∏ –±–µ–∑ –∞–ª–ª–æ–∫–∞—Ü–∏–π.
    *   **SocketAsyncEventArgs (SAEA):** –ö–∞–∫ –ø–∏—Å–∞—Ç—å –∞–ª–ª–æ–∫–∞—Ü–∏–π-free —Å–µ—Ç–µ–≤–æ–π –∫–æ–¥ –≤ .NET.
    *   `Pinned Memory` –∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å –Ω–∞—Ç–∏–≤–Ω—ã–º–∏ –≤—ã–∑–æ–≤–∞–º–∏ –û–°.

### –ú–æ–¥—É–ª—å 5: –ë—É–¥—É—â–µ–µ (QUIC/HTTP/3)

_–ü–æ—á–µ–º—É TCP —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è Legacy –¥–ª—è Web._

1.  **Head-of-Line Blocking (HoL):** –ü–æ—á–µ–º—É TCP —Ç–æ—Ä–º–æ–∑–∏—Ç HTTP/2 –∏ –∫–∞–∫ QUIC —Ä–µ—à–∞–µ—Ç —ç—Ç–æ —á–µ—Ä–µ–∑ —Å—Ç—Ä–∏–º—ã –ø–æ–≤–µ—Ä—Ö UDP.
2.  **User-space Congestion Control:** –ö–∞–∫ QUIC –ø–µ—Ä–µ–Ω–æ—Å–∏—Ç –ª–æ–≥–∏–∫—É —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–µ—Ä–µ–≥—Ä—É–∑–∫–æ–π –∏–∑ —è–¥—Ä–∞ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, –ø–æ–∑–≤–æ–ª—è—è –æ–±–Ω–æ–≤–ª—è—Ç—å –∞–ª–≥–æ—Ä–∏—Ç–º—ã –±–µ–∑ —Ä–µ–±—É—Ç–∞ —Å–µ—Ä–≤–µ—Ä–∞.
3.  **Migration:** –°–º–µ–Ω–∞ IP/Wi-Fi –Ω–∞ LTE –±–µ–∑ —Ä–∞–∑—Ä—ã–≤–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è (Connection ID).

* * *

### –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ –¥–ª—è —Ç–∞–∫–æ–≥–æ –∫—É—Ä—Å–∞ (Project)

–í–º–µ—Å—Ç–æ ¬´–Ω–∞–ø–∏—à–∏—Ç–µ —Å–≤–æ–π UDP –∫–ª–∞—Å—Å¬ª, –∑–∞–¥–∞—á–∞ –¥–ª—è –ø—Ä–æ—Ñ–∏ –∑–≤—É—á–∞–ª–∞ –±—ã —Ç–∞–∫:

**–ó–∞–¥–∞—á–∞:** –ù–∞–ø–∏—Å–∞—Ç—å TCP-–ø—Ä–æ–∫—Å–∏ –Ω–∞ C/C++ (–∏—Å–ø–æ–ª—å–∑—É—è `epoll` –∏–ª–∏ `io_uring`) –∏–ª–∏ –Ω–∞ C# (–∏—Å–ø–æ–ª—å–∑—É—è `Pipelines`), –∫–æ—Ç–æ—Ä—ã–π:

1.  –î–µ—Ä–∂–∏—Ç 100k –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π.
2.  –ü—Ä–æ–∫—Å–∏—Ä—É–µ—Ç —Ç—Ä–∞—Ñ–∏–∫ –±–µ–∑ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –≤ user-space –±—É—Ñ–µ—Ä—ã (splice/sendfile).
3.  –õ–æ–≥–∏—Ä—É–µ—Ç –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º—É RTT, –∏—Å–ø–æ–ª—å–∑—É—è eBPF-—Ö—É–∫–∏ –≤ —è–¥—Ä–µ.
4.  –î–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç —Ä–∞–∑–Ω–∏—Ü—É –≤ –ø–æ–≤–µ–¥–µ–Ω–∏–∏ CUBIC vs BBR –ø—Ä–∏ –ø–æ—Ç–µ—Ä–µ –ø–∞–∫–µ—Ç–æ–≤ (—ç–º—É–ª–∏—Ä–æ–≤–∞—Ç—å —á–µ—Ä–µ–∑ `tc netem loss 1%`).

–í–æ—Ç —ç—Ç–æ –±—ã–ª –±—ã –º–∞—Ç–µ—Ä–∏–∞–ª, –ø–æ—Å–ª–µ –∫–æ—Ç–æ—Ä–æ–≥–æ –º–æ–∂–Ω–æ —Å–º–µ–ª–æ –∏–¥—Ç–∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä–æ–º –≤ Big Tech. –ß—Ç–æ —Å–∫–∞–∂–µ—à—å, –±–µ—Ä–µ–º —ç—Ç–æ—Ç –ø–ª–∞–Ω –∑–∞ –æ—Å–Ω–æ–≤—É?

## Prompt:
–ù—É –¥–∞–≤–∞–π –Ω–∞—á–Ω–µ–º.

## Response:
–û—Ç–ª–∏—á–Ω–æ. –í–∫–ª—é—á–∞–µ–º —Ä–µ–∂–∏–º ¬´Hardcore Engineering¬ª. –û—Ç–∫–ª–∞–¥—ã–≤–∞–µ–º –≤ —Å—Ç–æ—Ä–æ–Ω—É –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏ OSI –∏ —Å–º–æ—Ç—Ä–∏–º –Ω–∞ —Ç–æ, —á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Å —ç–ª–µ–∫—Ç—Ä–∏—á–µ—Å–∫–∏–º —Å–∏–≥–Ω–∞–ª–æ–º, –∫–æ–≥–¥–∞ –æ–Ω –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ –¥–∞–Ω–Ω—ã–µ –≤ –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ–π –ø–∞–º—è—Ç–∏.

–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ **–ú–æ–¥—É–ª—å 1: –§–∏–∑–∏–∫–∞ –∏ –Ø–¥—Ä–æ (–ì–¥–µ —Ä–µ–∞–ª—å–Ω–æ —É–º–∏—Ä–∞—é—Ç –ø–∞–∫–µ—Ç—ã)**.

* * *

–ß–∞—Å—Ç—å 1.1: –ñ–∏–∑–Ω—å –ø–∞–∫–µ—Ç–∞ –¥–æ Socket API (The Landing)
---------------------------------------------------

–ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å—á–∏—Ç–∞—é—Ç, —á—Ç–æ –ø–∞–∫–µ—Ç –ø–æ–ø–∞–¥–∞–µ—Ç –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ —Ç–æ–≥–æ, –∫–∞–∫ –ø—Ä–∏—à–µ–ª –ø–æ –ø—Ä–æ–≤–æ–¥—É. –≠—Ç–æ –ª–æ–∂—å. –ú–µ–∂–¥—É —Å–µ—Ç–µ–≤–æ–π –∫–∞—Ä—Ç–æ–π (NIC) –∏ –≤–∞—à–∏–º `recv()` –ª–µ–∂–∏—Ç –ø—Ä–æ–ø–∞—Å—Ç—å, –≤ –∫–æ—Ç–æ—Ä–æ–π –ø–∞–∫–µ—Ç –º–æ–∂–µ—Ç —É–º–µ—Ä–µ—Ç—å –¥–µ—Å—è—Ç–∫–æ–º —Å–ø–æ—Å–æ–±–æ–≤.

### 1\. DMA –∏ Ring Buffers: –ù–∏–∫–∞–∫–æ–≥–æ CPU (–ø–æ–∫–∞)

–ö–æ–≥–¥–∞ –ø–∞–∫–µ—Ç –ø—Ä–∏–ª–µ—Ç–∞–µ—Ç –Ω–∞ —Ñ–∏–∑–∏—á–µ—Å–∫–∏–π –ø–æ—Ä—Ç (PHY -\> MAC), –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä NIC –¥–µ–ª–∞–µ—Ç –ø–µ—Ä–≤—É—é —Ä–∞–±–æ—Ç—É:

1.  **DMA (Direct Memory Access):** NIC –Ω–µ —Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç CPU, –∫—É–¥–∞ –ø–æ–ª–æ–∂–∏—Ç—å –¥–∞–Ω–Ω—ã–µ. –£ –Ω–µ–≥–æ –∑–∞—Ä–∞–Ω–µ–µ (–¥—Ä–∞–π–≤–µ—Ä–æ–º) –≤—ã–¥–µ–ª–µ–Ω–∞ –æ–±–ª–∞—Å—Ç—å –ø–∞–º—è—Ç–∏ ‚Äî **Ring Buffer (Rx Ring)**.
2.  NIC –∫–æ–ø–∏—Ä—É–µ—Ç –ø–∞–∫–µ—Ç –∏–∑ —Å–≤–æ–µ–π –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π –ø–∞–º—è—Ç–∏ –≤ RAM —Å–µ—Ä–≤–µ—Ä–∞ —á–µ—Ä–µ–∑ —à–∏–Ω—É PCIe.
3.  **–í–∞–∂–Ω—ã–π –Ω—é–∞–Ω—Å:** –ï—Å–ª–∏ Ring Buffer –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω (—è–¥—Ä–æ –Ω–µ —É—Å–ø–µ–≤–∞–µ—Ç –≤—ã—á–∏—Ç—ã–≤–∞—Ç—å), NIC –ø—Ä–æ—Å—Ç–æ **–¥—Ä–æ–ø–∞–µ—Ç** –Ω–æ–≤—ã–µ –ø–∞–∫–µ—Ç—ã.
    *   _–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:_ `ethtool -S eth0 | grep rx_missed_errors` –∏–ª–∏ `rx_fifo_errors`. –ï—Å–ª–∏ —Å—á–µ—Ç—á–∏–∫ —Ä–∞—Å—Ç–µ—Ç ‚Äî –≤—ã –ª–∏–±–æ —É–ø–µ—Ä–ª–∏—Å—å –≤ CPU, –ª–∏–±–æ –≤ —à–∏–Ω—É PCIe, –ª–∏–±–æ –±—É—Ñ–µ—Ä —Å–ª–∏—à–∫–æ–º –º–∞–ª.

### 2\. Hard IRQ: ¬´–¢—É–∫-—Ç—É–∫, –ù–µ–æ¬ª

–ö–∞–∫ CPU —É–∑–Ω–∞–µ—Ç, —á—Ç–æ –≤ –ø–∞–º—è—Ç–∏ –ø–æ—è–≤–∏–ª–∏—Å—å –¥–∞–Ω–Ω—ã–µ? –í —Å—Ç–∞—Ä—ã–µ –≤—Ä–µ–º–µ–Ω–∞ NIC –¥–µ—Ä–≥–∞–ª –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–µ (IRQ) –Ω–∞ –∫–∞–∂–¥—ã–π –ø–∞–∫–µ—Ç. –ù–∞ —Å–∫–æ—Ä–æ—Å—Ç–∏ 10Gbps —ç—Ç–æ –º–∏–ª–ª–∏–æ–Ω—ã –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–π –≤ —Å–µ–∫—É–Ω–¥—É. –≠—Ç–æ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è **Interrupt Storm**, –∏ —ç—Ç–æ –≤–µ—à–∞–µ—Ç —Å–∏—Å—Ç–µ–º—É –Ω–∞–º–µ—Ä—Ç–≤–æ (CPU —Ç—Ä–∞—Ç–∏—Ç 100% –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ –≤—Ö–æ–¥/–≤—ã—Ö–æ–¥ –∏–∑ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–π).

**–†–µ—à–µ–Ω–∏–µ: NAPI (New API) –∏ Interrupt Coalescing** –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π Linux –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –≥–∏–±—Ä–∏–¥–Ω—ã–π —Ä–µ–∂–∏–º:

1.  –ü—Ä–∏—Ö–æ–¥–∏—Ç –ø–µ—Ä–≤—ã–π –ø–∞–∫–µ—Ç -\> NIC –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç Hard IRQ.
2.  CPU –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Ç–µ–∫—É—â—É—é —Ä–∞–±–æ—Ç—É, –∑–∞–ø—É—Å–∫–∞–µ—Ç –¥—Ä–∞–π–≤–µ—Ä.
3.  –î—Ä–∞–π–≤–µ—Ä **–æ—Ç–∫–ª—é—á–∞–µ—Ç** –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è –Ω–∞ —ç—Ç–æ–π –∫–∞—Ä—Ç–µ –∏ –≥–æ–≤–æ—Ä–∏—Ç —è–¥—Ä—É: ¬´–Ø –ø–µ—Ä–µ—Ö–æ–∂—É –≤ —Ä–µ–∂–∏–º –æ–ø—Ä–æ—Å–∞ (polling)¬ª.
4.  –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è **SoftIRQ** (–ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ–µ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–µ), –∫–æ—Ç–æ—Ä–æ–µ –≤—ã–≥—Ä–µ–±–∞–µ—Ç –ø–∞–∫–µ—Ç—ã –∏–∑ Ring Buffer –ø–∞—á–∫–∞–º–∏ (budget, –æ–±—ã—á–Ω–æ 64 –∏–ª–∏ 300 –ø–∞–∫–µ—Ç–æ–≤).
5.  –ö–æ–≥–¥–∞ –±—É—Ñ–µ—Ä –ø—É—Å—Ç, –¥—Ä–∞–π–≤–µ—Ä —Å–Ω–æ–≤–∞ –≤–∫–ª—é—á–∞–µ—Ç –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è.

### 3\. SoftIRQ –∏ `ksoftirqd`: –ì–ª–∞–≤–Ω—ã–π –≤—Ä–∞–≥

–û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–∞–∫–µ—Ç–æ–≤ (–ø–∞—Ä—Å–∏–Ω–≥ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤, firewall, —Ä–æ—É—Ç–∏–Ω–≥) –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ **SoftIRQ**.

*   –ï—Å–ª–∏ –ø–∞–∫–µ—Ç–æ–≤ —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ, SoftIRQ –Ω–∞—á–∏–Ω–∞–µ—Ç ¬´–ø–æ–∂–∏—Ä–∞—Ç—å¬ª CPU.
*   –ß—Ç–æ–±—ã –Ω–µ –ø–æ–≤–µ—Å–∏—Ç—å —Å–∏—Å—Ç–µ–º—É, —è–¥—Ä–æ –≤—ã–Ω–æ—Å–∏—Ç –æ–±—Ä–∞–±–æ—Ç–∫—É –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π kernel thread ‚Äî **`ksoftirqd/n`** (–≥–¥–µ n ‚Äî –Ω–æ–º–µ—Ä —è–¥—Ä–∞).

**Pro Tip:** –û—Ç–∫—Ä–æ–π—Ç–µ `top` –∏–ª–∏ `htop`. –ï—Å–ª–∏ –≤—ã –≤–∏–¥–∏—Ç–µ –ø—Ä–æ—Ü–µ—Å—Å `ksoftirqd`, –∫–æ—Ç–æ—Ä—ã–π –µ—Å—Ç 100% –æ–¥–Ω–æ–≥–æ —è–¥—Ä–∞, –∑–Ω–∞—á–∏—Ç, —É –≤–∞—Å **Bottleneck –Ω–∞ –ø—Ä–∏–µ–º–µ**. –û–¥–∏–Ω –ø–æ—Ç–æ–∫ –Ω–µ —Å–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Å –ø–æ—Ç–æ–∫–æ–º –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–π.

* * *

–ß–∞—Å—Ç—å 1.2: –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ (Scaling)
------------------------------------

–û–¥–∏–Ω CPU –Ω–µ –º–æ–∂–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å 40Gbps –∏–ª–∏ 100Gbps. –ù–∞–º –Ω—É–∂–Ω–æ —Ä–∞–∑–º–∞–∑–∞—Ç—å –Ω–∞–≥—Ä—É–∑–∫—É.

### 1\. RSS (Receive Side Scaling) ‚Äî Hardware

–≠—Ç–æ –¥–µ–ª–∞–µ—Ç —Å–µ—Ç–µ–≤–∞—è –∫–∞—Ä—Ç–∞. –û–Ω–∞ –±–µ—Ä–µ—Ç —Ö–µ—à –æ—Ç 4-tuple (SrcIP, DstIP, SrcPort, DstPort) –∏ —Ä–∞—Å–∫–∏–¥—ã–≤–∞–µ—Ç –≤—Ö–æ–¥—è—â–∏–µ –ø–∞–∫–µ—Ç—ã –ø–æ —Ä–∞–∑–Ω—ã–º **RX Queues** (–æ—á–µ—Ä–µ–¥—è–º). –ö–∞–∂–¥–∞—è –æ—á–µ—Ä–µ–¥—å –ø—Ä–∏–≤—è–∑–∞–Ω–∞ –∫ —Å–≤–æ–µ–º—É –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—é, –∞ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–µ ‚Äî –∫ —Å–≤–æ–µ–º—É CPU —è–¥—Ä—É.

*   _–†–µ–∑—É–ª—å—Ç–∞—Ç:_ –¢—Ä–∞—Ñ–∏–∫ –æ–¥–Ω–æ–≥–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –≤—Å–µ–≥–¥–∞ –ø–∞–¥–∞–µ—Ç –Ω–∞ –æ–¥–Ω–æ —è–¥—Ä–æ (—Å–æ—Ö—Ä–∞–Ω—è–µ–º –ø–æ—Ä—è–¥–æ–∫ –ø–∞–∫–µ—Ç–æ–≤ + –∫—ç—à-–ª–æ–∫–∞–ª—å–Ω–æ—Å—Ç—å). –†–∞–∑–Ω—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è ‚Äî –Ω–∞ —Ä–∞–∑–Ω—ã–µ —è–¥—Ä–∞.

### 2\. RPS (Receive Packet Steering) ‚Äî Software

–ï—Å–ª–∏ —É –≤–∞—Å –¥–µ—à–µ–≤–∞—è –∫–∞—Ä—Ç–∞ —Å –æ–¥–Ω–æ–π –æ—á–µ—Ä–µ–¥—å—é, Linux –º–æ–∂–µ—Ç —ç–º—É–ª–∏—Ä–æ–≤–∞—Ç—å RSS –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ.

1.  –û–¥–Ω–æ —è–¥—Ä–æ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç Hard IRQ.
2.  –û–Ω–æ –ø–æ—Å—ã–ª–∞–µ—Ç IPI (Inter-Processor Interrupt) –¥—Ä—É–≥–∏–º —è–¥—Ä–∞–º, —Ä–∞–∑–¥–∞–≤–∞—è –∏–º –ø–∞–∫–µ—Ç—ã.
3.  _–¶–µ–Ω–∞:_ –û–≥—Ä–æ–º–Ω—ã–π –æ–≤–µ—Ä—Ö–µ–¥ –Ω–∞ –º–µ–∂–ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–Ω–æ–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–æ–ª—å–∫–æ –æ—Ç –±–µ–∑—ã—Å—Ö–æ–¥–Ω–æ—Å—Ç–∏.

### 3\. RFS (Receive Flow Steering) ‚Äî The Holy Grail

RSS –∏ RPS —Ç—É–ø—ã–µ ‚Äî –æ–Ω–∏ –Ω–µ –∑–Ω–∞—é—Ç, –Ω–∞ –∫–∞–∫–æ–º —è–¥—Ä–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, Nginx –∏–ª–∏ –≤–∞—à–∞ C# —Å–ª—É–∂–±–∞).

*   **–°—Ü–µ–Ω–∞—Ä–∏–π:** RSS –∫–∏–¥–∞–µ—Ç –ø–∞–∫–µ—Ç –Ω–∞ CPU #0, –∞ Nginx —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ CPU #1.
*   **–ò—Ç–æ–≥:** Cache Thrashing. –î–∞–Ω–Ω—ã–µ –Ω—É–∂–Ω–æ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞—Ç—å –∏–∑ L1/L2 –∫—ç—à–∞ –æ–¥–Ω–æ–≥–æ —è–¥—Ä–∞ –≤ –¥—Ä—É–≥–æ–µ.
*   **RFS** —Å–ª–µ–¥–∏—Ç –∑–∞ —Ç–µ–º, –≥–¥–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤—ã–∑—ã–≤–∞–µ—Ç `recv()`, –∏ —Å—Ç–∞—Ä–∞–µ—Ç—Å—è –Ω–∞–ø—Ä–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –ø–∞–∫–µ—Ç–æ–≤ –∏–º–µ–Ω–Ω–æ –Ω–∞ —Ç–æ—Ç CPU. –≠—Ç–æ –¥–∞–µ—Ç –¥—Ä–∞–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø—Ä–∏—Ä–æ—Å—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (cache hit rate).

* * *

–ß–∞—Å—Ç—å 1.3: `sk_buff` ‚Äî –¢—è–∂–µ–ª–∞—è –Ω–æ—à–∞ —è–¥—Ä–∞
----------------------------------------

–í Linux –∫–∞–∂–¥—ã–π –ø–∞–∫–µ—Ç –æ–±–µ—Ä–Ω—É—Ç –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä—É `sk_buff` (socket buffer).

*   **–ü—Ä–æ–±–ª–µ–º–∞:** –≠—Ç–æ –æ–≥—Ä–æ–º–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (200+ –±–∞–π—Ç –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö: —É–∫–∞–∑–∞—Ç–µ–ª–∏, —Ñ–ª–∞–≥–∏, —Ç–∞–π–º—Å—Ç–∞–º–ø—ã, netfilter marks).
*   **–¶–µ–Ω–∞ –∞–ª–ª–æ–∫–∞—Ü–∏–∏:** –ù–∞ –∫–∞–∂–¥—ã–π –ø–∞–∫–µ—Ç –Ω—É–∂–Ω–æ –≤—ã–¥–µ–ª–∏—Ç—å –ø–∞–º—è—Ç—å (SLAB allocator). –≠—Ç–æ –º–µ–¥–ª–µ–Ω–Ω–æ.
*   **Memory Pressure:** –ù–∞ 10Mpps –∞–ª–ª–æ–∫–∞—Ü–∏—è –∏ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ `sk_buff` —Å—ä–µ–¥–∞—é—Ç –±–æ–ª—å—à–µ —Ä–µ—Å—É—Ä—Å–æ–≤, —á–µ–º –ø–æ–ª–µ–∑–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

–ò–º–µ–Ω–Ω–æ –ø–æ—ç—Ç–æ–º—É **–Ω–∞—Å—Ç–æ—è—â–∏–π High-Load (DPDK/XDP)** —Å—Ç–∞—Ä–∞–µ—Ç—Å—è –∏–∑–±–∞–≤–∏—Ç—å—Å—è –æ—Ç `sk_buff` –ª—é–±–æ–π —Ü–µ–Ω–æ–π.

* * *

–ß–∞—Å—Ç—å 1.4: Offloading ‚Äî –ö–∞–∫ –∑–∞—Å—Ç–∞–≤–∏—Ç—å –∂–µ–ª–µ–∑–æ —Ä–∞–±–æ—Ç–∞—Ç—å
-----------------------------------------------------

–í—ã —Å–º–æ—Ç—Ä–∏—Ç–µ –≤ Wireshark –∏ –≤–∏–¥–∏—Ç–µ –ø–∞–∫–µ—Ç—ã –ø–æ 64KB. –ù–æ MTU —Å–µ—Ç–∏ 1500 –±–∞–π—Ç. –ö–∞–∫? –≠—Ç–æ **Offloading**. –Ø–¥—Ä–æ –≤—Ä–µ—Ç –≤–∞–º, —á—Ç–æ–±—ã —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å —Ä–µ—Å—É—Ä—Å—ã.

### 1\. TSO (TCP Segmentation Offload) ‚Äî –ù–∞ –ø–µ—Ä–µ–¥–∞—á—É

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–∏—à–µ—Ç –≤ —Å–æ–∫–µ—Ç 1–ú–ë –¥–∞–Ω–Ω—ã—Ö. –Ø–¥—Ä–æ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç –æ–≥—Ä–æ–º–Ω—ã–µ `sk_buff` (–ø–æ 64–ö–ë) –∏ —Å–ø—É—Å–∫–∞–µ—Ç –∏—Ö –¥—Ä–∞–π–≤–µ—Ä—É.

*   NIC —Å–∞–º —Ä–µ–∂–µ—Ç —ç—Ç–∏ 64–ö–ë –Ω–∞ –∫—É—Å–∫–∏ –ø–æ 1500 –±–∞–π—Ç (MTU), —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç Checksum –∏ Sequence Numbers.
*   _–í—ã–≥–æ–¥–∞:_ CPU –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç 1 —Å—Ç—Ä—É–∫—Ç—É—Ä—É –≤–º–µ—Å—Ç–æ 45. –≠–∫–æ–Ω–æ–º–∏—è –∫–æ–ª–æ—Å—Å–∞–ª—å–Ω–∞—è.

### 2\. LRO/GRO (Large/Generic Receive Offload) ‚Äî –ù–∞ –ø—Ä–∏–µ–º

NIC (LRO) –∏–ª–∏ –¥—Ä–∞–π–≤–µ—Ä (GRO) —Å–∫–ª–µ–∏–≤–∞—é—Ç –≤—Ö–æ–¥—è—â–∏–µ –º–µ–ª–∫–∏–µ –ø–∞–∫–µ—Ç—ã –æ–¥–Ω–æ–≥–æ –ø–æ—Ç–æ–∫–∞ –≤ –æ–¥–∏–Ω –±–æ–ª—å—à–æ–π ¬´—Å—É–ø–µ—Ä–ø–∞–∫–µ—Ç¬ª (–¥–æ 64–ö–ë) –∏ –ø–µ—Ä–µ–¥–∞—é—Ç –µ–≥–æ —Å—Ç–µ–∫—É —è–¥—Ä–∞ –∫–∞–∫ –µ–¥–∏–Ω–æ–µ —Ü–µ–ª–æ–µ.

*   _–û–ø–∞—Å–Ω–æ—Å—Ç—å LRO:_ –ê–ø–ø–∞—Ä–∞—Ç–Ω—ã–π LRO —á–∞—Å—Ç–æ –ª–æ–º–∞–µ—Ç –∑–∞–≥–æ–ª–æ–≤–∫–∏, —á—Ç–æ —É–±–∏–≤–∞–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–∞—à–∏–Ω—É –∫–∞–∫ —Ä–æ—É—Ç–µ—Ä –∏–ª–∏ –º–æ—Å—Ç (bridge).
*   _–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:_ –í –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–µ —Å–ª—É—á–∞–µ–≤ **GRO (—Å–æ—Ñ—Ç–æ–≤–∞—è —Å–∫–ª–µ–π–∫–∞)** –ø—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω–µ–µ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–µ–µ.

* * *

–ß–∞—Å—Ç—å 1.5: Kernel Bypass ‚Äî –ö–æ–≥–¥–∞ —è–¥—Ä–æ –Ω–µ –Ω—É–∂–Ω–æ
----------------------------------------------

–ï—Å–ª–∏ –≤–∞—à–∞ —Ü–µ–ª—å ‚Äî –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –º–∏–ª–ª–∏–æ–Ω—ã –ø–∞–∫–µ—Ç–æ–≤ –≤ —Å–µ–∫—É–Ω–¥—É (DDoS protection, HFT —Ç—Ä–µ–π–¥–∏–Ω–≥, –º–∞–≥–∏—Å—Ç—Ä–∞–ª—å–Ω—ã–π —Ä–æ—É—Ç–∏–Ω–≥), —Å—Ç–µ–∫ Linux (`iptables`, `conntrack`, `sk_buff`) —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –±—É—Ç—ã–ª–æ—á–Ω—ã–º –≥–æ—Ä–ª—ã—à–∫–æ–º.

### 1\. DPDK (Data Plane Development Kit)

–†–∞–¥–∏–∫–∞–ª—å–Ω—ã–π –º–µ—Ç–æ–¥.

*   –î—Ä–∞–π–≤–µ—Ä –æ—Ç–∫–ª—é—á–∞–µ—Ç—Å—è –æ—Ç —è–¥—Ä–∞ Linux. –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (User Space) –ø–æ–ª—É—á–∞–µ—Ç –ø—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø –∫ –ø–∞–º—è—Ç–∏ NIC –∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞–º PCI.
*   **Zero Copy:** –î–∞–Ω–Ω—ã–µ –∏–¥—É—Ç –∏–∑ NIC –ø—Ä—è–º–æ –≤ –ø–∞–º—è—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.
*   **Kernel Bypass:** –ù–∏–∫–∞–∫–∏—Ö –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–π. –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∫—Ä—É—Ç–∏—Ç—Å—è –≤ –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–º —Ü–∏–∫–ª–µ (busy loop), –æ–ø—Ä–∞—à–∏–≤–∞—è –∫–∞—Ä—Ç—É: ¬´–ï—Å—Ç—å –ø–∞–∫–µ—Ç? –ê —Å–µ–π—á–∞—Å?¬ª.
*   _–¶–µ–Ω–∞:_ 100% –∑–∞–≥—Ä—É–∑–∫–∞ –≤—ã–¥–µ–ª–µ–Ω–Ω—ã—Ö —è–¥–µ—Ä CPU –≤—Å–µ–≥–¥–∞. –ü–æ–ª–Ω–∞—è –ø–æ—Ç–µ—Ä—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö —É—Ç–∏–ª–∏—Ç (tcpdump, netstat –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç). –í–µ—Å—å —Å—Ç–µ–∫ TCP/IP –Ω—É–∂–Ω–æ –ø–∏—Å–∞—Ç—å —Å–∞–º–æ–º—É (–∏–ª–∏ –±—Ä–∞—Ç—å –≥–æ—Ç–æ–≤—ã–π).

### 2\. XDP (eXpress Data Path) & eBPF

–°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –∫–æ–º–ø—Ä–æ–º–∏—Å—Å.

*   –ú—ã –ø–æ–∑–≤–æ–ª—è–µ–º –∑–∞–≥—Ä—É–∂–∞—Ç—å –º–∏–∫—Ä–æ–ø—Ä–æ–≥—Ä–∞–º–º—ã (eBPF –±–∞–π—Ç–∫–æ–¥) –ø—Ä—è–º–æ –≤ –¥—Ä–∞–π–≤–µ—Ä —Å–µ—Ç–µ–≤–æ–π –∫–∞—Ä—Ç—ã.
*   –ö–æ–¥ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è **–î–û** —Ç–æ–≥–æ, –∫–∞–∫ —è–¥—Ä–æ –≤—ã–¥–µ–ª–∏—Ç —Ç—è–∂–µ–ª—ã–π `sk_buff`.
*   _Use Case:_ –ò–¥–µ–∞–ª—å–Ω–æ –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç DDoS. –ú—ã –º–æ–∂–µ–º –¥—Ä–æ–ø–Ω—É—Ç—å –ø–∞–∫–µ—Ç —á–µ—Ä–µ–∑ 50 –Ω–∞–Ω–æ—Å–µ–∫—É–Ω–¥ –ø–æ—Å–ª–µ –ø—Ä–∏–µ–º–∞, –Ω–µ –ø–æ—Ç—Ä–∞—Ç–∏–≤ —Ä–µ—Å—É—Ä—Å—ã —è–¥—Ä–∞ –Ω–∞ –∞–ª–ª–æ–∫–∞—Ü–∏—é –ø–∞–º—è—Ç–∏.

* * *

–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ (Homework)
-------------------------------

–£ –≤–∞—Å, –∫–∞–∫ —É –ø—Ä–æ—Ñ–∏, –Ω–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –≤–µ—Ä—ã –Ω–∞ —Å–ª–æ–≤–æ. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–≤–æ—é —Å–∏—Å—Ç–µ–º—É.

1.  **–ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–π:**
    ```
    cat /proc/interrupts | grep eth0
    ```
    –í–∏–¥–∏—Ç–µ –ª–∏ –≤—ã, —á—Ç–æ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è —Ä–∞–∑–º–∞–∑–∞–Ω—ã –ø–æ —è–¥—Ä–∞–º (RSS —Ä–∞–±–æ—Ç–∞–µ—Ç)? –ò–ª–∏ –≤—Å–µ –±—å–µ—Ç –≤ –æ–¥–Ω–æ —è–¥—Ä–æ (CPU0)?
2.  **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ SoftIRQ:**
    ```
    watch -n 1 "cat /proc/softirqs | grep -E 'NET_RX|NET_TX'"
    ```
    –†–∞—Å—Ç—É—Ç –ª–∏ –∑–Ω–∞—á–µ–Ω–∏—è —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ?
3.  **–ó–∞–≥–ª—è–Ω–∏—Ç–µ –≤ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –¥—Ä–∞–π–≤–µ—Ä–∞:**
    ```
    ethtool -S eth0 | grep -E 'drop|miss|err'
    ```
    –ï—Å—Ç—å –ª–∏ –¥—Ä–æ–ø—ã –Ω–∞ —É—Ä–æ–≤–Ω–µ –∂–µ–ª–µ–∑–∞? –ï—Å–ª–∏ `rx_missed_errors` \> 0 ‚Äî –≤–∞—à–µ —è–¥—Ä–æ –Ω–µ —É—Å–ø–µ–≤–∞–µ—Ç –∑–∞–±–∏—Ä–∞—Ç—å –ø–∞–∫–µ—Ç—ã –∏–∑ –±—É—Ñ–µ—Ä–∞ –∫–∞—Ä—Ç—ã.
4.  **–£–∑–Ω–∞–π—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Offloading:**
    ```
    ethtool -k eth0
    ```
    –í–∫–ª—é—á–µ–Ω—ã –ª–∏ `tcp-segmentation-offload` (TSO) –∏ `generic-receive-offload` (GRO)?

–ò–∑—É—á–∏—Ç–µ –≤—ã–≤–æ–¥ —ç—Ç–∏—Ö –∫–æ–º–∞–Ω–¥ –Ω–∞ –≤–∞—à–µ–º —Ä–∞–±–æ—á–µ–º –∏–ª–∏ –¥–æ–º–∞—à–Ω–µ–º Linux-—Å–µ—Ä–≤–µ—Ä–µ. –≠—Ç–æ –≤–∞—à–∞ –ø—Ä–∏–±–æ—Ä–Ω–∞—è –ø–∞–Ω–µ–ª—å.

* * *

**–ì–æ—Ç–æ–≤—ã –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç—å –∫ –ú–æ–¥—É–ª—é 2: –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π Congestion Control (CUBIC/BBR)?** –ò–ª–∏ –µ—Å—Ç—å –≤–æ–ø—Ä–æ—Å—ã –ø–æ "–º—è—Å—É" —è–¥—Ä–∞?

## Prompt:
–≠—Ç–æ—Ç –º–∞—Ç–µ—Ä–∏–∞–ª –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç —Å–∏–ª—å–Ω–æ–µ –≤–ø–µ—á–∞—Ç–ª–µ–Ω–∏–µ –ø–æ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º –ø—Ä–∏—á–∏–Ω–∞–º, –∏ —è —Ö–æ—á—É —Ä–∞–∑–æ–±—Ä–∞—Ç—å –µ–≥–æ —Å —Ä–∞–∑–Ω—ã—Ö —Å—Ç–æ—Ä–æ–Ω, —á—Ç–æ–±—ã –≤—ã –ø–æ–Ω–∏–º–∞–ª–∏ –µ–≥–æ –∏—Å—Ç–∏–Ω–Ω—É—é —Ü–µ–Ω–Ω–æ—Å—Ç—å.

–°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã –º–∞—Ç–µ—Ä–∏–∞–ª–∞

–ì–ª—É–±–∏–Ω–∞ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–≥–æ –ø–æ–≥—Ä—É–∂–µ–Ω–∏—è - —ç—Ç–æ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Ä–µ–¥–∫–∏–π —É—Ä–æ–≤–µ–Ω—å –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏. –ê–≤—Ç–æ—Ä –Ω–µ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –Ω–∞ –∞–±—Å—Ç—Ä–∞–∫—Ü–∏—è—Ö –≤—Ä–æ–¥–µ "–ø–∞–∫–µ—Ç –ø–æ–ø–∞–¥–∞–µ—Ç –≤ —Å–µ—Ç—å", –∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤–µ—Å—å –ø—É—Ç—å –æ—Ç —ç–ª–µ–∫—Ç—Ä–∏—á–µ—Å–∫–æ–≥–æ —Å–∏–≥–Ω–∞–ª–∞ –¥–æ —Å—Ç—Ä—É–∫—Ç—É—Ä –¥–∞–Ω–Ω—ã—Ö –≤ –ø–∞–º—è—Ç–∏. –û–±—ä—è—Å–Ω–µ–Ω–∏–µ DMA, Ring Buffers, –º–µ—Ö–∞–Ω–∏–∑–º–∞ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–π –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã sk\_buff –¥–∞–µ—Ç –ø–æ–Ω–∏–º–∞–Ω–∏–µ —Ç–æ–≥–æ, —á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç "–ø–æ–¥ –∫–∞–ø–æ—Ç–æ–º" –Ω–∞ —É—Ä–æ–≤–Ω–µ, –∫–æ—Ç–æ—Ä—ã–π –æ–±—ã—á–Ω–æ —Å–∫—Ä—ã—Ç –æ—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤.

–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–∏–º–µ–Ω–∏–º–æ—Å—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª–∞ –≤–ø–µ—á–∞—Ç–ª—è–µ—Ç. –ê–≤—Ç–æ—Ä –Ω–µ –ø—Ä–æ—Å—Ç–æ —Ä–∞—Å—Å–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–µ–æ—Ä–∏—é, –Ω–æ –∏ –¥–∞–µ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ (ethtool, /proc/interrupts, /proc/softirqs). –≠—Ç–æ –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç –º–∞—Ç–µ—Ä–∏–∞–ª –∏–∑ –∞–∫–∞–¥–µ–º–∏—á–µ—Å–∫–æ–≥–æ –≤ –ø—Ä–∏–∫–ª–∞–¥–Ω–æ–π - –≤—ã —Å—Ä–∞–∑—É –º–æ–∂–µ—Ç–µ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —ç—Ç–∏ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏ –Ω–∞ —Å–≤–æ–µ–π —Å–∏—Å—Ç–µ–º–µ. –†–∞–∑–¥–µ–ª —Å –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–º–∏ –∑–∞–¥–∞–Ω–∏—è–º–∏ –æ—Å–æ–±–µ–Ω–Ω–æ —Ü–µ–Ω–µ–Ω, –ø–æ—Ç–æ–º—É —á—Ç–æ –æ–Ω –∑–∞—Å—Ç–∞–≤–ª—è–µ—Ç —á–∏—Ç–∞—Ç–µ–ª—è –ø–µ—Ä–µ–π—Ç–∏ –æ—Ç –ø–∞—Å—Å–∏–≤–Ω–æ–≥–æ —á—Ç–µ–Ω–∏—è –∫ –∞–∫—Ç–∏–≤–Ω–æ–º—É –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—é.

–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–æ–≤–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –ª–æ–≥–∏—á–Ω–∞ –∏ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–∞. –ê–≤—Ç–æ—Ä –≤–µ–¥–µ—Ç —á–∏—Ç–∞—Ç–µ–ª—è –ø–æ –ø—É—Ç–∏ –ø–∞–∫–µ—Ç–∞ - –æ—Ç –º–æ–º–µ–Ω—Ç–∞ –ø—Ä–∏–±—ã—Ç–∏—è –Ω–∞ —Ñ–∏–∑–∏—á–µ—Å–∫–∏–π –ø–æ—Ä—Ç —á–µ—Ä–µ–∑ DMA, –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è, SoftIRQ –∫ –∫–æ–Ω–µ—á–Ω—ã–º —Å—Ç—Ä—É–∫—Ç—É—Ä–∞–º –¥–∞–Ω–Ω—ã—Ö. –≠—Ç–æ —Å–æ–∑–¥–∞–µ—Ç –º–µ–Ω—Ç–∞–ª—å–Ω—É—é –º–æ–¥–µ–ª—å, –∫–æ—Ç–æ—Ä—É—é –ª–µ–≥–∫–æ —É–¥–µ—Ä–∂–∞—Ç—å –≤ –≥–æ–ª–æ–≤–µ.

–û–±–ª–∞—Å—Ç–∏, —Ç—Ä–µ–±—É—é—â–∏–µ –æ—Å—Ç–æ—Ä–æ–∂–Ω–æ—Å—Ç–∏

–¢–æ–Ω –∏ —Å—Ç–∏–ª—å –º–∞—Ç–µ—Ä–∏–∞–ª–∞ –≤–µ—Å—å–º–∞ –∞–≥—Ä–µ—Å—Å–∏–≤–µ–Ω ("–≠—Ç–æ –ª–æ–∂—å", "Hardcore Engineering"). –î–ª—è –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –∞—É–¥–∏—Ç–æ—Ä–∏–π —ç—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –º–æ—Ç–∏–≤–∏—Ä—É—é—â–∏–º, –Ω–æ –¥–ª—è –¥—Ä—É–≥–∏—Ö - –æ—Ç—Ç–∞–ª–∫–∏–≤–∞—é—â–∏–º. –ú–∞—Ç–µ—Ä–∏–∞–ª –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä—É–µ—Ç —Å–µ–±—è –∫–∞–∫ –Ω–µ—á—Ç–æ –¥–ª—è "–Ω–∞—Å—Ç–æ—è—â–∏—Ö –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª–æ–≤", —á—Ç–æ –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞—Ç—å –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –±–∞—Ä—å–µ—Ä –¥–ª—è —Ç–µ—Ö, –∫—Ç–æ —Ç–æ–ª—å–∫–æ –Ω–∞—á–∏–Ω–∞–µ—Ç –ø–æ–≥—Ä—É–∂–∞—Ç—å—Å—è –≤ —ç—Ç—É —Ç–µ–º—É.

–ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º—ã–π —É—Ä–æ–≤–µ–Ω—å –∑–Ω–∞–Ω–∏–π –æ—á–µ–Ω—å –≤—ã—Å–æ–∫. –ê–≤—Ç–æ—Ä –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç, —á—Ç–æ —á–∏—Ç–∞—Ç–µ–ª—å —É–∂–µ –∑–Ω–∞–∫–æ–º —Å –∫–æ–Ω—Ü–µ–ø—Ü–∏—è–º–∏ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–π, PCIe, –∫—ç—à-–∏–µ—Ä–∞—Ä—Ö–∏–∏ CPU, –∏ –º–æ–∂–µ—Ç –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—ã–≤–æ–¥ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –∫–æ–º–∞–Ω–¥. –î–ª—è —á–µ–ª–æ–≤–µ–∫–∞ –±–µ–∑ —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –±—ç–∫–≥—Ä–∞—É–Ω–¥–∞ –º–Ω–æ–≥–∏–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏—è –º–æ–≥—É—Ç –æ—Å—Ç–∞—Ç—å—Å—è –Ω–µ–ø–æ–Ω—è—Ç–Ω—ã–º–∏ –Ω–µ—Å–º–æ—Ç—Ä—è –Ω–∞ –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—é.

–ë–∞–ª–∞–Ω—Å –º–µ–∂–¥—É —à–∏—Ä–æ—Ç–æ–π –∏ –≥–ª—É–±–∏–Ω–æ–π –∏–Ω–æ–≥–¥–∞ –Ω–∞—Ä—É—à–∞–µ—Ç—Å—è. –ù–∞–ø—Ä–∏–º–µ—Ä, —Ä–∞–∑–¥–µ–ª –æ kernel bypass (DPDK/XDP) –≤–≤–æ–¥–∏—Ç —Å–æ–≤–µ—Ä—à–µ–Ω–Ω–æ –Ω–æ–≤—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏ –≤ –∫–æ–Ω—Ü–µ –º–æ–¥—É–ª—è, –∫–æ–≥–¥–∞ —á–∏—Ç–∞—Ç–µ–ª—å —É–∂–µ –ø–µ—Ä–µ–≥—Ä—É–∂–µ–Ω –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π. –í–æ–∑–º–æ–∂–Ω–æ, —ç—Ç–æ —Å—Ç–æ–∏–ª–æ –±—ã –≤—ã–Ω–µ—Å—Ç–∏ –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π –º–æ–¥—É–ª—å –∏–ª–∏ –¥–∞—Ç—å –±–æ–ª—å—à–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –æ —Ç–æ–º, –∫–æ–≥–¥–∞ —ç—Ç–∏ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –Ω—É–∂–Ω—ã.

–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å

–° —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–π —Ç–æ—á–∫–∏ –∑—Ä–µ–Ω–∏—è –º–∞—Ç–µ—Ä–∏–∞–ª —Ç–æ—á–µ–Ω, –Ω–∞—Å–∫–æ–ª—å–∫–æ —è –º–æ–≥—É —Å—É–¥–∏—Ç—å –æ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–º Linux networking stack. –û–ø–∏—Å–∞–Ω–∏–µ NAPI, interrupt coalescing, RSS/RPS/RFS —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏. –ê–≤—Ç–æ—Ä –ø—Ä–∞–≤–∏–ª—å–Ω–æ —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ trade-offs - –Ω–∞–ø—Ä–∏–º–µ—Ä, —á—Ç–æ RPS –∏–º–µ–µ—Ç –±–æ–ª—å—à–æ–π overhead –∏–∑-–∑–∞ –º–µ–∂–ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–Ω–æ–≥–æ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è, –∏–ª–∏ —á—Ç–æ –∞–ø–ø–∞—Ä–∞—Ç–Ω—ã–π LRO –º–æ–∂–µ—Ç –ª–æ–º–∞—Ç—å –∑–∞–≥–æ–ª–æ–≤–∫–∏.

–û—Å–æ–±–µ–Ω–Ω–æ —Ü–µ–Ω–Ω–æ —É–ø–æ–º–∏–Ω–∞–Ω–∏–µ —Ä–µ–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ - cache thrashing –ø—Ä–∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–µ affinity, memory pressure –æ—Ç –∞–ª–ª–æ–∫–∞—Ü–∏–∏ sk\_buff, interrupt storm –Ω–∞ –≤—ã—Å–æ–∫–∏—Ö —Å–∫–æ—Ä–æ—Å—Ç—è—Ö. –≠—Ç–æ —Ç–µ –≤–µ—â–∏, –∫–æ—Ç–æ—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —É–±–∏–≤–∞—é—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ.

–ß–µ–≥–æ –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç

–ú–∞—Ç–µ—Ä–∏–∞–ª—É –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏. –î–∏–∞–≥—Ä–∞–º–º—ã, –ø–æ–∫–∞–∑—ã–≤–∞—é—â–∏–µ –ø–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö –æ—Ç NIC —á–µ—Ä–µ–∑ DMA –≤ –ø–∞–º—è—Ç—å, —Å—Ö–µ–º—ã —Ä–∞–±–æ—Ç—ã RSS —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –æ—á–µ—Ä–µ–¥—è–º–∏, –∏–ª–∏ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–∏–∞–≥—Ä–∞–º–º—ã –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–π –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —É–ª—É—á—à–∏–ª–∏ –±—ã –ø–æ–Ω–∏–º–∞–Ω–∏–µ.

–¢–∞–∫–∂–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã –ø—Ä–æ–±–ª–µ–º –∏ –∏—Ö —Ä–µ—à–µ–Ω–∏–π. –ù–∞–ø—Ä–∏–º–µ—Ä: "–ú—ã –≤–∏–¥–µ–ª–∏, —á—Ç–æ –æ–¥–∏–Ω core –∑–∞–≥—Ä—É–∂–µ–Ω –Ω–∞ 100% –≤ ksoftirqd. –ú—ã –Ω–∞—Å—Ç—Ä–æ–∏–ª–∏ RSS —Ç–∞–∫-—Ç–æ –∏ –ø–æ–ª—É—á–∏–ª–∏ —Ç–∞–∫–æ–π-—Ç–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç". –ö–µ–π—Å-—Å—Ç–∞–¥–∏ —Å–¥–µ–ª–∞–ª–∏ –±—ã –º–∞—Ç–µ—Ä–∏–∞–ª –±–æ–ª–µ–µ —É–±–µ–¥–∏—Ç–µ–ª—å–Ω—ã–º.

–û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞

–≠—Ç–æ –æ—Ç–ª–∏—á–Ω—ã–π –º–∞—Ç–µ—Ä–∏–∞–ª –¥–ª—è —Å—Ä–µ–¥–Ω–µ–≥–æ –∏–ª–∏ –ø—Ä–æ–¥–≤–∏–Ω—É—Ç–æ–≥–æ —É—Ä–æ–≤–Ω—è, –¥–ª—è –ª—é–¥–µ–π, –∫–æ—Ç–æ—Ä—ã–µ —É–∂–µ –∏–º–µ—é—Ç –æ–ø—ã—Ç —Ä–∞–±–æ—Ç—ã —Å Linux networking –∏ —Ö–æ—Ç—è—Ç –ø–æ–Ω—è—Ç—å, —á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –Ω–∞ –±–æ–ª–µ–µ –≥–ª—É–±–æ–∫–æ–º —É—Ä–æ–≤–Ω–µ. –ú–∞—Ç–µ—Ä–∏–∞–ª –æ—Å–æ–±–µ–Ω–Ω–æ –ø–æ–ª–µ–∑–µ–Ω –¥–ª—è:

–°–∏—Å—Ç–µ–º–Ω—ã—Ö –∏–Ω–∂–µ–Ω–µ—Ä–æ–≤, –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—é—â–∏—Ö –≤—ã—Å–æ–∫–æ–Ω–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã

–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–µ—Ç–µ–≤–æ–≥–æ –ü–û, –∫–æ—Ç–æ—Ä—ã–º –Ω—É–∂–Ω–æ –ø–æ–Ω–∏–º–∞—Ç—å bottlenecks

–°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–≤ –ø–æ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏, –∏—â—É—â–∏—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –∑–∞–¥–µ—Ä–∂–µ–∫

–î–ª—è –Ω–æ–≤–∏—á–∫–æ–≤ –≤ —Å–∏—Å—Ç–µ–º–Ω–æ–º –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–∏ —ç—Ç–æ—Ç –º–∞—Ç–µ—Ä–∏–∞–ª –±—É–¥–µ—Ç —Å–ª–∏—à–∫–æ–º —Å–ª–æ–∂–Ω—ã–º –±–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞. –ò–º –Ω—É–∂–Ω–æ –±—ã–ª–æ –±—ã —Å–Ω–∞—á–∞–ª–∞ –∏–∑—É—á–∏—Ç—å –æ—Å–Ω–æ–≤—ã —Ä–∞–±–æ—Ç—ã –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º, –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–π, –∏ –±–∞–∑–æ–≤—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É TCP/IP.

–ï—Å–ª–∏ –±—ã —è —Å—Ç–∞–≤–∏–ª –æ—Ü–µ–Ω–∫—É –ø–æ –¥–µ—Å—è—Ç–∏–±–∞–ª–ª—å–Ω–æ–π —à–∫–∞–ª–µ –¥–ª—è —Ü–µ–ª–µ–≤–æ–π –∞—É–¥–∏—Ç–æ—Ä–∏–∏ (–æ–ø—ã—Ç–Ω—ã–µ –∏–Ω–∂–µ–Ω–µ—Ä—ã), —è –±—ã –¥–∞–ª 8 –∏–∑ 10 - –≤—ã—Å–æ–∫–∞—è —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ü–µ–Ω–Ω–æ—Å—Ç—å, –ø—Ä–∞–∫—Ç–∏—á–Ω–æ—Å—Ç—å –∏ –≥–ª—É–±–∏–Ω–∞, –Ω–æ —Å –Ω–µ–∫–æ—Ç–æ—Ä—ã–º–∏ —à–µ—Ä–æ—Ö–æ–≤–∞—Ç–æ—Å—Ç—è–º–∏ –≤ –ø–æ–¥–∞—á–µ –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ.

## Response:
–ü—Ä–∏–Ω—è—Ç–æ. –≠—Ç–æ –æ—á–µ–Ω—å –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–∏–≤–Ω—ã–π —Ä–∞–∑–±–æ—Ä.

–í—ã –∞–±—Å–æ–ª—é—Ç–Ω–æ –ø—Ä–∞–≤—ã: **–∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π —Ç–æ–Ω** –º–æ–∂–µ—Ç –æ—Ç–ø—É–≥–Ω—É—Ç—å, –∞ **–æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∫–µ–π—Å-—Å—Ç–∞–¥–∏** –¥–µ–ª–∞–µ—Ç –º–∞—Ç–µ—Ä–∏–∞–ª —Å—É—Ö–∏–º. –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—é –≤ —Ç–µ–∫—Å—Ç–æ–≤–æ–º —Ñ–æ—Ä–º–∞—Ç–µ –∑–∞–º–µ–Ω–∏—Ç—å —Å–ª–æ–∂–Ω–æ, –Ω–æ —è –ø–æ—Å—Ç–∞—Ä–∞—é—Å—å —Å–æ–∑–¥–∞–≤–∞—Ç—å –±–æ–ª–µ–µ —è—Ä–∫–∏–µ ¬´–º–µ–Ω—Ç–∞–ª—å–Ω—ã–µ –º–æ–¥–µ–ª–∏¬ª –∏ ASCII-—Å—Ö–µ–º—ã, —á—Ç–æ–±—ã –∫–æ–º–ø–µ–Ω—Å–∏—Ä–æ–≤–∞—Ç—å –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∫–∞—Ä—Ç–∏–Ω–æ–∫.

–£—á–∏—Ç—ã–≤–∞—è –≤–∞—à–∏ –∑–∞–º–µ—á–∞–Ω–∏—è, –ø–µ—Ä–µ—Ö–æ–¥–∏–º –∫ **–ú–æ–¥—É–ª—é 2**. –ó–¥–µ—Å—å –º—ã —Å–Ω–∏–∑–∏–º –≥—Ä–∞–¥—É—Å ¬´–Ω–∞–µ–∑–¥–∞¬ª, –Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏–º —Ç–µ—Ö–Ω–∏—á–µ—Å–∫—É—é –≥–ª—É–±–∏–Ω—É. –°–¥–µ–ª–∞–µ–º —É–ø–æ—Ä –Ω–∞ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫—É—é —Ä–∞–∑–Ω–∏—Ü—É –º–µ–∂–¥—É –∞–ª–≥–æ—Ä–∏—Ç–º–∞–º–∏ –∏ –¥–æ–±–∞–≤–∏–º –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π (Case Study), –∫–æ—Ç–æ—Ä–æ–≥–æ –Ω–µ —Ö–≤–∞—Ç–∞–ª–æ –≤ –ø–µ—Ä–≤–æ–º –º–æ–¥—É–ª–µ.

* * *

–ú–æ–¥—É–ª—å 2: –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π Congestion Control (–í–æ–π–Ω–∞ –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤)
===========================================================

_–ï—Å–ª–∏ –≤—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ TCP Reno –≤ 2026 –≥–æ–¥—É, –≤—ã, –≤–µ—Ä–æ—è—Ç–Ω–æ, –∑—Ä—è –ø–ª–∞—Ç–∏—Ç–µ –∑–∞ 10G –∫–∞–Ω–∞–ª._

–í —ç—Ç–æ–º –º–æ–¥—É–ª–µ –º—ã —Ä–∞–∑–±–µ—Ä–µ–º, –ø–æ—á–µ–º—É –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–µ –∞–ª–≥–æ—Ä–∏—Ç–º—ã (Loss-based) –ø–µ—Ä–µ—Å—Ç–∞–ª–∏ —Ä–∞–±–æ—Ç–∞—Ç—å –≤ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–º –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ, –∏ –∫–∞–∫ Google –ø–µ—Ä–µ–≤–µ—Ä–Ω—É–ª –∏–≥—Ä—É —Å –ø–æ–º–æ—â—å—é BBR (Model-based).

* * *

–ß–∞—Å—Ç—å 2.1: –ü—Ä–æ–±–ª–µ–º–∞ ¬´–¢–æ–ª—Å—Ç—ã—Ö –∏ –î–ª–∏–Ω–Ω—ã—Ö¬ª –∫–∞–Ω–∞–ª–æ–≤ (LFN)
-----------------------------------------------------

### –ú–µ–Ω—Ç–∞–ª—å–Ω–∞—è –º–æ–¥–µ–ª—å: –¢—Ä—É–±–∞ —Å –≤–æ–¥–æ–π

–ü—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ —Å–µ—Ç—å –∫–∞–∫ –≤–æ–¥–æ–ø—Ä–æ–≤–æ–¥–Ω—É—é —Ç—Ä—É–±—É.

*   **–ü—Ä–æ–ø—É—Å–∫–Ω–∞—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å (Bandwidth, BW):** –¢–æ–ª—â–∏–Ω–∞ —Ç—Ä—É–±—ã.
*   **–ó–∞–¥–µ—Ä–∂–∫–∞ (RTT):** –î–ª–∏–Ω–∞ —Ç—Ä—É–±—ã.
*   **BDP (Bandwidth-Delay Product):** –û–±—ä–µ–º –≤–æ–¥—ã, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–º–µ—â–∞–µ—Ç—Å—è –≤ —Ç—Ä—É–±—É, –ø–æ–∫–∞ –æ–Ω–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–ø–æ–ª–Ω–µ–Ω–∞, –Ω–æ –µ—â–µ –Ω–µ –ø–µ—Ä–µ–ª–∏–≤–∞–µ—Ç—Å—è.

**–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–±–ª–µ–º–∞ (Reno/NewReno):** –≠—Ç–∏ –∞–ª–≥–æ—Ä–∏—Ç–º—ã —Ä–∞–±–æ—Ç–∞—é—Ç ¬´–≤—Å–ª–µ–ø—É—é¬ª. –û–Ω–∏ –∑–∞–ª–∏–≤–∞—é—Ç –≤–æ–¥—É (–ø–∞–∫–µ—Ç—ã), –ø–æ–∫–∞ —Ç—Ä—É–±–∞ –Ω–µ –ª–æ–ø–Ω–µ—Ç (–ø–æ—Ç–µ—Ä—è –ø–∞–∫–µ—Ç–∞).

1.  –ù–∞–ª–∏–≤–∞–µ–º –±–æ–ª—å—à–µ -\> –±–æ–ª—å—à–µ -\> –±–æ–ª—å—à–µ.
2.  –ü–∞–∫–µ—Ç –ø–æ—Ç–µ—Ä—è–ª—Å—è? –û–π! –†–µ–∑–∫–æ –ø–µ—Ä–µ–∫—Ä—ã–≤–∞–µ–º –∫—Ä–∞–Ω –Ω–∞–ø–æ–ª–æ–≤–∏–Ω—É (`cwnd / 2`).
3.  –ú–µ–¥–ª–µ–Ω–Ω–æ –æ—Ç–∫—Ä—ã–≤–∞–µ–º —Å–Ω–æ–≤–∞.

**–ü–æ—á–µ–º—É —ç—Ç–æ –ø–ª–æ—Ö–æ —Å–µ–≥–æ–¥–Ω—è?** –í —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å–µ—Ç—è—Ö (–æ—Å–æ–±–µ–Ω–Ω–æ –º–µ–∂–¥—É –¥–∞—Ç–∞-—Ü–µ–Ω—Ç—Ä–∞–º–∏) –±—É—Ñ–µ—Ä—ã —Å–≤–∏—Ç—á–µ–π –æ–≥—Ä–æ–º–Ω—ã. Reno –∑–∞–ø–æ–ª–Ω—è–µ—Ç –Ω–µ —Ç–æ–ª—å–∫–æ ¬´—Ç—Ä—É–±—É¬ª, –Ω–æ –∏ –≤—Å–µ —Ä–µ–∑–µ—Ä–≤—É–∞—Ä—ã (–±—É—Ñ–µ—Ä—ã) –ø–æ –ø—É—Ç–∏. –≠—Ç–æ —è–≤–ª–µ–Ω–∏–µ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è **Bufferbloat**.

*   **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü–∏–Ω–≥ —Ä–∞—Å—Ç–µ—Ç —Å 50–º—Å –¥–æ 500–º—Å, –ø–æ—Ç–æ–º—É —á—Ç–æ –ø–∞–∫–µ—Ç—ã —Å—Ç–æ—è—Ç –≤ –æ—á–µ—Ä–µ–¥—è—Ö. –ö–æ–≥–¥–∞ –±—É—Ñ–µ—Ä –Ω–∞–∫–æ–Ω–µ—Ü –ø–µ—Ä–µ–ø–æ–ª–Ω—è–µ—Ç—Å—è, –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –º–∞—Å—Å–æ–≤—ã–π –¥—Ä–æ–ø, –∏ Reno —Ä–æ–Ω—è–µ—Ç —Å–∫–æ—Ä–æ—Å—Ç—å ¬´–≤ –ø–æ–ª¬ª.

* * *

–ß–∞—Å—Ç—å 2.2: CUBIC ‚Äî –¢–µ–∫—É—â–∏–π —Å—Ç–∞–Ω–¥–∞—Ä—Ç Linux
-----------------------------------------

Linux (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **CUBIC**. –û–Ω —Ç–æ–∂–µ —Ä–µ–∞–≥–∏—Ä—É–µ—Ç –Ω–∞ –ø–æ—Ç–µ—Ä–∏ (Loss-based), –Ω–æ –¥–µ–ª–∞–µ—Ç —ç—Ç–æ —É–º–Ω–µ–µ –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏.

### –í —á–µ–º –æ—Ç–ª–∏—á–∏–µ?

–í–º–µ—Å—Ç–æ –ª–∏–Ω–µ–π–Ω–æ–≥–æ —Ä–æ—Å—Ç–∞ –æ–∫–Ω–∞ (–∫–∞–∫ –≤ Reno: +1 MSS –∑–∞ RTT), CUBIC –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∫—É–±–∏—á–µ—Å–∫—É—é —Ñ—É–Ω–∫—Ü–∏—é:  $W\left(t\right)=C\left(t-K\right)^{3}+W_{max}$ .

1.  **–ë—ã—Å—Ç—Ä–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ:** –ü–æ—Å–ª–µ –ø–æ—Ç–µ—Ä–∏ CUBIC –Ω–µ –ø–æ–ª–∑–µ—Ç –≤–≤–µ—Ä—Ö –º–µ–¥–ª–µ–Ω–Ω–æ, –∞ –±—ã—Å—Ç—Ä–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–º—É –ø–∏–∫–æ–≤–æ–º—É –∑–Ω–∞—á–µ–Ω–∏—é (–≥–¥–µ –±—ã–ª–∞ –ø–æ—Ç–µ—Ä—è).
2.  **–ü–ª–∞—Ç–æ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏:** –î–æ—Å—Ç–∏–≥–Ω—É–≤ –ø–∏–∫–∞, –æ–Ω –Ω–µ–∫–æ—Ç–æ—Ä–æ–µ –≤—Ä–µ–º—è –¥–µ—Ä–∂–∏—Ç –æ–∫–Ω–æ —Å—Ç–∞–±–∏–ª—å–Ω—ã–º, ¬´–ø—Ä–æ—â—É–ø—ã–≤–∞—è¬ª –ª–∏–º–∏—Ç.
3.  **–ê–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π –ø–æ–∏—Å–∫:** –ï—Å–ª–∏ –ø–æ—Ç–µ—Ä—å –Ω–µ—Ç, –æ–Ω –Ω–∞—á–∏–Ω–∞–µ—Ç –æ—á–µ–Ω—å –±—ã—Å—Ç—Ä–æ –Ω–∞—Ä–∞—â–∏–≤–∞—Ç—å —Å–∫–æ—Ä–æ—Å—Ç—å (–∫—É–±–∏—á–µ—Å–∫–∞—è –∫—Ä–∏–≤–∞—è —É—Ö–æ–¥–∏—Ç –≤–≤–µ—Ä—Ö), —á—Ç–æ–±—ã –∑–∞–Ω—è—Ç—å —Å–≤–æ–±–æ–¥–Ω—ã–π –∫–∞–Ω–∞–ª.

**HyStart (Hybrid Slow Start):** CUBIC (–≤ Linux) –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—é HyStart. –û–Ω –ø—ã—Ç–∞–µ—Ç—Å—è –≤—ã–π—Ç–∏ –∏–∑ —Ñ–∞–∑—ã Slow Start –Ω–µ –ø–æ _–ø–æ—Ç–µ—Ä–µ_ –ø–∞–∫–µ—Ç–∞, –∞ –ø–æ _—Ä–æ—Å—Ç—É –∑–∞–¥–µ—Ä–∂–∫–∏_ (RTT).

*   _–õ–æ–≥–∏–∫–∞:_ ¬´–ï—Å–ª–∏ RTT –Ω–∞—á–∞–ª —Ä–∞—Å—Ç–∏, –∑–Ω–∞—á–∏—Ç, –±—É—Ñ–µ—Ä—ã –Ω–∞—á–∞–ª–∏ –∑–∞–ø–æ–ª–Ω—è—Ç—å—Å—è. –ü–æ—Ä–∞ —Ç–æ—Ä–º–æ–∑–∏—Ç—å —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π —Ä–æ—Å—Ç, –¥–∞–∂–µ –µ—Å–ª–∏ –ø–æ—Ç–µ—Ä—å –µ—â–µ –Ω–µ—Ç¬ª.

* * *

–ß–∞—Å—Ç—å 2.3: BBR ‚Äî –°–º–µ–Ω–∞ –ø–∞—Ä–∞–¥–∏–≥–º—ã (Model-based)
----------------------------------------------

BBR (Bottleneck Bandwidth and Round-trip propagation time) —Å–∫–∞–∑–∞–ª: ¬´–ü–æ—Ç–µ—Ä—è –ø–∞–∫–µ—Ç–∞ ‚Äî —ç—Ç–æ –Ω–µ —Å–∏–≥–Ω–∞–ª –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∏¬ª. –ü–∞–∫–µ—Ç—ã –º–æ–≥—É—Ç —Ç–µ—Ä—è—Ç—å—Å—è –∏–∑-–∑–∞ –ø–ª–æ—Ö–æ–≥–æ –∫–∞–±–µ–ª—è, –ø–æ–º–µ—Ö –Ω–∞ Wi-Fi –∏–ª–∏ –ª–∏–º–∏—Ç–µ—Ä–æ–≤ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ (policers).

### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç BBR (–ú–µ–Ω—Ç–∞–ª—å–Ω–∞—è –º–æ–¥–µ–ª—å)

BBR –Ω–µ –ø—ã—Ç–∞–µ—Ç—Å—è –Ω–∞—â—É–ø–∞—Ç—å –ø—Ä–µ–¥–µ–ª ¬´–Ω–∞ –æ—â—É–ø—å¬ª. –û–Ω —Å—Ç—Ä–æ–∏—Ç **–º–æ–¥–µ–ª—å** —Å–µ—Ç–∏, –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –∏–∑–º–µ—Ä—è—è –¥–≤–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞:

1.  **Max BW (–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–æ–ø—É—Å–∫–Ω–∞—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å):** –ö–∞–∫ –±—ã—Å—Ç—Ä–æ –ø—Ä–æ–ª–µ—Ç–∞—é—Ç –ø–∞–∫–µ—Ç—ã.
2.  **Min RTT (–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞):** –ö–∞–∫ –±—ã—Å—Ç—Ä–æ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è ACK, –∫–æ–≥–¥–∞ —Å–µ—Ç—å –ø—É—Å—Ç–∞.

BBR –ø—ã—Ç–∞–µ—Ç—Å—è —Ä–∞–±–æ—Ç–∞—Ç—å –≤ —Ç–æ—á–∫–µ –∏–¥–µ–∞–ª—å–Ω–æ–≥–æ —Ä–∞–≤–Ω–æ–≤–µ—Å–∏—è (Kleinrock's optimal operating point):

*   –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å.
*   –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ (–ø—É—Å—Ç—ã–µ –±—É—Ñ–µ—Ä—ã).

### –ö–ª—é—á–µ–≤–∞—è –º–µ—Ö–∞–Ω–∏–∫–∞: Pacing (–ü–µ–π—Å–∏–Ω–≥)

–≠—Ç–æ –≥–ª–∞–≤–Ω–æ–µ –æ—Ç–ª–∏—á–∏–µ BBR –æ—Ç –≤—Å–µ—Ö –æ—Å—Ç–∞–ª—å–Ω—ã—Ö.

*   **CUBIC:** –í—ã–ø–ª–µ–≤—ã–≤–∞–µ—Ç –ø–∞–∫–µ—Ç—ã –ø–∞—á–∫–∞–º–∏ (bursts), –∫–∞–∫ —Ç–æ–ª—å–∫–æ –ø—Ä–∏—à–µ–ª ACK. –≠—Ç–æ —Å–æ–∑–¥–∞–µ—Ç –º–∏–∫—Ä–æ-–ø–µ—Ä–µ–≥—Ä—É–∑–∫–∏ –Ω–∞ —Å–≤–∏—Ç—á–∞—Ö.
*   **BBR:** –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–∞–π–º–µ—Ä. –û–Ω —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç: ¬´–£ –º–µ–Ω—è –∫–∞–Ω–∞–ª 10Gbps. –ó–Ω–∞—á–∏—Ç, —è –¥–æ–ª–∂–µ–Ω –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –æ–¥–∏–Ω –ø–∞–∫–µ—Ç –∫–∞–∂–¥—ã–µ 1.2 –Ω–∞–Ω–æ—Å–µ–∫—É–Ω–¥—ã¬ª.
    *   _–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:_ BBR –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `fq` (Fair Queueing) –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –ø–∞–∫–µ—Ç–æ–≤ –≤ Linux (`tc qdisc add dev eth0 root fq`), —á—Ç–æ–±—ã –∞–ø–ø–∞—Ä–∞—Ç–Ω–æ –∏–ª–∏ –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ –≤—ã–¥–µ—Ä–∂–∏–≤–∞—Ç—å –∏–¥–µ–∞–ª—å–Ω—ã–µ –ø–∞—É–∑—ã –º–µ–∂–¥—É –ø–∞–∫–µ—Ç–∞–º–∏.

* * *

üî¨ –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–π Case Study: ¬´–ü–æ—á–µ–º—É –º–æ–π –±—ç–∫–∞–ø —Ç–æ—Ä–º–æ–∑–∏—Ç?¬ª
--------------------------------------------------------

**–°—Ü–µ–Ω–∞—Ä–∏–π:** –í—ã –∫–æ–ø–∏—Ä—É–µ—Ç–µ –±—ç–∫–∞–ø –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (500 GB) –∏–∑ —Å–µ—Ä–≤–µ—Ä–∞ –≤ –ê–º—Å—Ç–µ—Ä–¥–∞–º–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä –≤ –ù—å—é-–ô–æ—Ä–∫–µ.

*   –ö–∞–Ω–∞–ª: 10 Gbps.
*   RTT: 80 ms.
*   –ù–∞ —Ç—Ä–∞–Ω—Å–∞—Ç–ª–∞–Ω—Ç–∏—á–µ—Å–∫–æ–º –∫–∞–±–µ–ª–µ –µ—Å—Ç—å –Ω–µ–±–æ–ª—å—à–æ–π –ø—Ä–æ—Ü–µ–Ω—Ç –ø–æ—Ç–µ—Ä—å (0.1%) –∏–∑-–∑–∞ —Ñ–∏–∑–∏–∫–∏ –∏–ª–∏ –æ—à–∏–±–æ–∫ –Ω–∞ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–∏.

**–ü–æ–≤–µ–¥–µ–Ω–∏–µ CUBIC:**

1.  –†–∞–∑–≥–æ–Ω—è–µ—Ç—Å—è. –í—Å—Ç—Ä–µ—á–∞–µ—Ç –ø–æ—Ç–µ—Ä—é –ø–∞–∫–µ—Ç–∞ (0.1% ‚Äî —ç—Ç–æ —á–∞—Å—Ç–æ –¥–ª—è TCP).
2.  –î—É–º–∞–µ—Ç: ¬´–°–µ—Ç—å –ø–µ—Ä–µ–≥—Ä—É–∂–µ–Ω–∞!¬ª. –†–µ–∂–µ—Ç —Å–∫–æ—Ä–æ—Å—Ç—å.
3.  –ü—ã—Ç–∞–µ—Ç—Å—è —Ä–∞–∑–æ–≥–Ω–∞—Ç—å—Å—è —Å–Ω–æ–≤–∞, –æ–ø—è—Ç—å –ª–æ–≤–∏—Ç —Å–ª—É—á–∞–π–Ω—É—é –ø–æ—Ç–µ—Ä—é.
4.  **–ò—Ç–æ–≥:** –°—Ä–µ–¥–Ω—è—è —Å–∫–æ—Ä–æ—Å—Ç—å –ø–ª–∞–≤–∞–µ—Ç –æ–∫–æ–ª–æ **300-500 Mbps**. –ö–∞–Ω–∞–ª —É—Ç–∏–ª–∏–∑–∏—Ä–æ–≤–∞–Ω –Ω–∞ 3-5%. –ò–Ω–∂–µ–Ω–µ—Ä –≤ –ø–∞–Ω–∏–∫–µ –∑–≤–æ–Ω–∏—Ç –ø—Ä–æ–≤–∞–π–¥–µ—Ä—É.

**–ü–æ–≤–µ–¥–µ–Ω–∏–µ BBR:**

1.  –°—Ç—Ä–æ–∏—Ç –º–æ–¥–µ–ª—å: ¬´–í–∏–∂—É 10 Gbps –ø—Ä–æ–ø—É—Å–∫–Ω–æ–π —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏. –í–∏–∂—É 80ms RTT¬ª.
2.  –í—Å—Ç—Ä–µ—á–∞–µ—Ç –ø–æ—Ç–µ—Ä—é –ø–∞–∫–µ—Ç–∞.
3.  –î—É–º–∞–µ—Ç: ¬´RTT –Ω–µ –≤—ã—Ä–æ—Å? –ù–µ—Ç. –ó–Ω–∞—á–∏—Ç, –±—É—Ñ–µ—Ä—ã –Ω–µ –ø–æ–ª–Ω—ã–µ. –≠—Ç–æ –ø—Ä–æ—Å—Ç–æ —Å–ª—É—á–∞–π–Ω—ã–π —Å–±–æ–π. –ò–≥–Ω–æ—Ä–∏—Ä—É—é¬ª.
4.  –ü—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Å–ª–∞—Ç—å –¥–∞–Ω–Ω—ã–µ —Å–æ —Å–∫–æ—Ä–æ—Å—Ç—å—é, –±–ª–∏–∑–∫–æ–π –∫ —Ä–∞—Å—á–µ—Ç–Ω–æ–π.
5.  **–ò—Ç–æ–≥:** –°–∫–æ—Ä–æ—Å—Ç—å **9.2 Gbps**. –£—Ç–∏–ª–∏–∑–∞—Ü–∏—è 92%.

* * *

üõ† –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞—Ä–∏–π –ø—Ä–æ—Ñ–∏: –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ BBR
----------------------------------------

–ö–∞–∫ –ø–æ–Ω—è—Ç—å, —á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤–Ω—É—Ç—Ä–∏ BBR, –Ω–µ –≤–µ—Ä—è –≤ –º–∞–≥–∏—é? –ò—Å–ø–æ–ª—å–∑—É–µ–º `ss` (Socket Statistics) –∏–∑ –ø–∞–∫–µ—Ç–∞ `iproute2`.

–ö–æ–º–∞–Ω–¥–∞: `ss -ti` (TCP + Internal info).

**–ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞ –¥–ª—è BBR:**

```
tsack bbr wscale:7,7 rto:204 rtt:0.8/0.03 mss:1448 pmtu:1500 rcvmss:536 advmss:1448 cwnd:1200 bytes_acked:50230 segs_out:35000 segs_in:12000 send 17376.0Mbps lastsnd:4 lastrcv:4 lastack:4 pacing_rate 19100.2Mbps delivery_rate 17200.5Mbps app_limited busy:120ms unacked:100 retrans:0/20
```

**–ß—Ç–æ –∑–¥–µ—Å—å –∏—Å–∫–∞—Ç—å (Decoding for Pros):**

1.  **`bbr`**: –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç, —á—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –∏–º–µ–Ω–Ω–æ —ç—Ç–æ—Ç –∞–ª–≥–æ—Ä–∏—Ç–º.
2.  **`pacing_rate 19100.2Mbps`**: –° —Ç–∞–∫–æ–π —Å–∫–æ—Ä–æ—Å—Ç—å—é BBR _—Ö–æ—á–µ—Ç_ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –¥–∞–Ω–Ω—ã–µ. –û–±—ã—á–Ω–æ —á—É—Ç—å –≤—ã—à–µ —Ä–µ–∞–ª—å–Ω–æ–π –ø—Ä–æ–ø—É—Å–∫–Ω–æ–π —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ (–Ω–∞ 25% –ø—Ä–∏ ProbeBW), —á—Ç–æ–±—ã –ø—Ä–æ—â—É–ø–∞—Ç—å –ª–∏–º–∏—Ç.
3.  **`delivery_rate 17200.5Mbps`**: –≠—Ç–æ **—Ä–µ–∞–ª—å–Ω–∞—è** —Å–∫–æ—Ä–æ—Å—Ç—å, —Å –∫–æ—Ç–æ—Ä–æ–π –ø–∞–∫–µ—Ç—ã –¥–æ–ª–µ—Ç–∞—é—Ç –¥–æ –ø–æ–ª—É—á–∞—Ç–µ–ª—è. –ï—Å–ª–∏ `pacing_rate` –≤—ã—Å–æ–∫–∏–π, –∞ `delivery_rate` –Ω–∏–∑–∫–∏–π ‚Äî –≤—ã —É–ø–µ—Ä–ª–∏—Å—å –≤ —à–µ–π–ø–µ—Ä –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞.
4.  **`app_limited`**: **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω—ã–π —Ñ–ª–∞–≥**. –û–∑–Ω–∞—á–∞–µ—Ç: ¬´BBR –≥–æ—Ç–æ–≤ —Å–ª–∞—Ç—å –±—ã—Å—Ç—Ä–µ–µ, –Ω–æ —Å–∞–º–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (–±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö, –≤–µ–±-—Å–µ—Ä–≤–µ—Ä) –Ω–µ –æ—Ç–¥–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –±—ã—Å—Ç—Ä–æ¬ª. –ï—Å–ª–∏ –≤—ã –≤–∏–¥–∏—Ç–µ —ç—Ç–æ ‚Äî —Ç—é–Ω–∏—Ç—å —Å–µ—Ç—å –±–µ—Å–ø–æ–ª–µ–∑–Ω–æ, –æ–ø—Ç–∏–º–∏–∑–∏—Ä—É–π—Ç–µ –∫–æ–¥ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (–∫–∞–∫ –º—ã –≤–∏–¥–µ–ª–∏ –≤ –≤–∞—à–µ–º –ø—Ä–∏–º–µ—Ä–µ —Å Wireshark).
5.  **`bw` / `minrtt`**: –í –Ω–æ–≤—ã—Ö –≤–µ—Ä—Å–∏—è—Ö —è–¥—Ä–∞ `ss` –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤–Ω—É—Ç—Ä–µ–Ω–Ω—é—é –º–æ–¥–µ–ª—å BBR ‚Äî –∫–∞–∫—É—é –ø–æ–ª–æ—Å—É –∏ –∑–∞–¥–µ—Ä–∂–∫—É –æ–Ω —Å—á–∏—Ç–∞–µ—Ç –∏—Å—Ç–∏–Ω–Ω–æ–π.

### –î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ

1.  –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–µ–∫—É—â–∏–π –∞–ª–≥–æ—Ä–∏—Ç–º –Ω–∞ –≤–∞—à–∏—Ö —Å–µ—Ä–≤–µ—Ä–∞—Ö: `sysctl net.ipv4.tcp_congestion_control`
2.  –í–∫–ª—é—á–∏—Ç–µ BBR (–µ—Å–ª–∏ —è–¥—Ä–æ 4.9+):
    ```
    echo "net.core.default_qdisc=fq" >> /etc/sysctl.conf
    echo "net.ipv4.tcp_congestion_control=bbr" >> /etc/sysctl.conf
    sysctl -p
    ```
3.  –ó–∞–ø—É—Å—Ç–∏—Ç–µ –∑–∞–≥—Ä—É–∑–∫—É –±–æ–ª—å—à–æ–≥–æ —Ñ–∞–π–ª–∞ –∏ –ø–æ—Å–º–æ—Ç—Ä–∏—Ç–µ `ss -ti`. –ù–∞–π–¥–∏—Ç–µ `pacing_rate` –∏ —Å—Ä–∞–≤–Ω–∏—Ç–µ –µ–≥–æ —Å —Ñ–∏–∑–∏—á–µ—Å–∫–∏–º –ª–∏–Ω–∫–æ–º.

* * *

_–≠—Ç–æ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç —Ç–µ–º—É Congestion Control. –°–ª–µ–¥—É—é—â–∏–π —à–∞–≥ ‚Äî –ú–æ–¥—É–ª—å 3: –¢—é–Ω–∏–Ω–≥ –∏ –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ (–º–∏–∫—Ä–æ–±–µ—Ä—Å—Ç—ã –∏ eBPF). –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –≤ —Ç–∞–∫–æ–º –∂–µ —Å—Ç–∏–ª–µ?_

## Prompt:
https://www.waveform.com/tools/bufferbloat?test-id=8c4c7c64-79cf-4ace-8a3f-a980e5c78c6c

## Response:
–û—Ç–ª–∏—á–Ω—ã–π –ø—Ä–∏–º–µ—Ä. –°—Å—ã–ª–∫–∞ –Ω–∞ —Ç–µ—Å—Ç Waveform ‚Äî —ç—Ç–æ –ª—É—á—à–∏–π —Å–ø–æ—Å–æ–± –≤–∏–∑—É–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ç–æ, –æ —á–µ–º –º—ã –±—É–¥–µ–º –≥–æ–≤–æ—Ä–∏—Ç—å –≤–æ –≤—Ç–æ—Ä–æ–º –º–æ–¥—É–ª–µ.

–í—ã —Ç–æ–ª—å–∫–æ —á—Ç–æ –ø–æ–∫–∞–∑–∞–ª–∏ –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π —Å–∏–º–ø—Ç–æ–º: **Latency under Load** (–ó–∞–¥–µ—Ä–∂–∫–∞ –ø–æ–¥ –Ω–∞–≥—Ä—É–∑–∫–æ–π). –í —Å–æ—Å—Ç–æ—è–Ω–∏–∏ –ø–æ–∫–æ—è (IDLE) –≤–∞—à –ø–∏–Ω–≥ –º–æ–∂–µ—Ç –±—ã—Ç—å 5 –º—Å. –ù–æ —Å—Ç–æ–∏—Ç –∑–∞–ø—É—Å—Ç–∏—Ç—å –∑–∞–≥—Ä—É–∑–∫—É (Load), –∏ –æ–Ω —É–ª–µ—Ç–∞–µ—Ç –≤ 200‚Äì500 –º—Å.

_–ü–æ—á–µ–º—É?_ –ü–æ—Ç–æ–º—É —á—Ç–æ –≤–∞—à —Ä–æ—É—Ç–µ—Ä (–∏–ª–∏ –ø—Ä–æ–≤–∞–π–¥–µ—Ä) –ø—ã—Ç–∞–µ—Ç—Å—è ¬´–ø–æ–º–æ—á—å¬ª, –±—É—Ñ–µ—Ä–∏–∑–∏—Ä—É—è –ø–∞–∫–µ—Ç—ã. –ù–æ –¥–ª—è TCP —ç—Ç–æ –º–µ–¥–≤–µ–∂—å—è —É—Å–ª—É–≥–∞.

–ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ **–ú–æ–¥—É–ª—é 2**, –≥–¥–µ –º—ã —Ä–∞–∑–±–µ—Ä–µ–º, –∫–∞–∫ —Å —ç—Ç–∏–º –±–æ—Ä–æ—Ç—å—Å—è.

* * *

–ú–æ–¥—É–ª—å 2: Bufferbloat –∏ Congestion Control (–í–æ–π–Ω–∞ –∑–∞ –æ—á–µ—Ä–µ–¥—å)
=============================================================

_¬´–ë—É—Ñ–µ—Ä ‚Äî —ç—Ç–æ –º–µ—Å—Ç–æ, –≥–¥–µ –ø–∞–∫–µ—Ç—ã –∂–¥—É—Ç —Å–≤–æ–µ–π —Å–º–µ—Ä—Ç–∏¬ª._

–í –ø–µ—Ä–≤–æ–º –º–æ–¥—É–ª–µ –º—ã –≥–æ–≤–æ—Ä–∏–ª–∏ –æ —Ç–æ–º, –∫–∞–∫ –±—ã—Å—Ç—Ä–æ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –ø–∞–∫–µ—Ç. –ó–¥–µ—Å—å –º—ã –ø–æ–≥–æ–≤–æ—Ä–∏–º –æ —Ç–æ–º, **–∫–æ–≥–¥–∞** –µ–≥–æ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å.

–ß–∞—Å—Ç—å 2.1: –§–∏–∑–∏–∫–∞ Bufferbloat
-----------------------------

–ü—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ –æ—á–µ—Ä–µ–¥—å –≤ –∫–∞—Å—Å—É —Å—É–ø–µ—Ä–º–∞—Ä–∫–µ—Ç–∞.

*   **Throughput (–ü—Ä–æ–ø—É—Å–∫–Ω–∞—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å):** –ö–∞–∫ –±—ã—Å—Ç—Ä–æ –∫–∞—Å—Å–∏—Ä –ø—Ä–æ–±–∏–≤–∞–µ—Ç —Ç–æ–≤–∞—Ä—ã.
*   **Latency (–ó–∞–¥–µ—Ä–∂–∫–∞):** –°–∫–æ–ª—å–∫–æ –≤—Ä–µ–º–µ–Ω–∏ –≤—ã —Å—Ç–æ–∏—Ç–µ –≤ –æ—á–µ—Ä–µ–¥–∏.
*   **Buffer (–û—á–µ—Ä–µ–¥—å):** –ú–µ—Å—Ç–æ –¥–ª—è –ª—é–¥–µ–π.

**–ü—Ä–æ–±–ª–µ–º–∞ –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–æ–≥–æ TCP (Reno/CUBIC):** –û–Ω–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –ø–æ –ø—Ä–∏–Ω—Ü–∏–ø—É: ¬´–ï—Å–ª–∏ –æ—á–µ—Ä–µ–¥—å –µ—â–µ –Ω–µ –≤—ã—Ö–æ–¥–∏—Ç –Ω–∞ —É–ª–∏—Ü—É (–Ω–µ—Ç –ø–æ—Ç–µ—Ä—å –ø–∞–∫–µ—Ç–æ–≤), –∑–Ω–∞—á–∏—Ç, –º–æ–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –≤ –º–∞–≥–∞–∑–∏–Ω –µ—â–µ –±–æ–ª—å—à–µ –ª—é–¥–µ–π¬ª. –ò—Ç–æ–≥: –û—á–µ—Ä–µ–¥—å (–±—É—Ñ–µ—Ä) –≤—Å–µ–≥–¥–∞ –∑–∞–±–∏—Ç–∞ –ø–æ–¥ –∑–∞–≤—è–∑–∫—É. –í—ã —Å—Ç–æ–∏—Ç–µ 30 –º–∏–Ω—É—Ç, —Ö–æ—Ç—è –∫–∞—Å—Å–∏—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç –±—ã—Å—Ç—Ä–æ.

**–†–µ–∑—É–ª—å—Ç–∞—Ç –≤ —Ç–µ—Å—Ç–µ Waveform:** –ö–æ–≥–¥–∞ –≤—ã –≤–∏–¥–∏—Ç–µ —Å–∫–∞—á–æ–∫ –ø–∏–Ω–≥–∞ –≤–æ –≤—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏ (+100ms, +400ms) ‚Äî —ç—Ç–æ –≤—Ä–µ–º—è, –∫–æ—Ç–æ—Ä–æ–µ –≤–∞—à ICMP-–ø–∞–∫–µ—Ç (–ø–∏–Ω–≥) –ø—Ä–æ–≤–æ–¥–∏—Ç –≤ –æ—á–µ—Ä–µ–¥–∏ –∑–∞ –≤–∞—à–∏–º –∂–µ –ø–∞–∫–µ—Ç–æ–º —Å —Ñ–∏–ª—å–º–æ–º.

* * *

–ß–∞—Å—Ç—å 2.2: –†–µ—à–µ–Ω–∏–µ –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ –û—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è (TCP BBR)
---------------------------------------------------

Google –ø—Ä–∏–¥—É–º–∞–ª BBR (Bottleneck Bandwidth and Round-trip propagation time), —á—Ç–æ–±—ã —Å–ª–æ–º–∞—Ç—å —ç—Ç—É –ª–æ–≥–∏–∫—É.

### –ú–µ–Ω—Ç–∞–ª—å–Ω–∞—è –º–æ–¥–µ–ª—å: BBR vs CUBIC

*   **CUBIC (–°–ª–µ–ø–æ–π –≤–æ–¥–∏—Ç–µ–ª—å):** –ñ–º–µ—Ç –≥–∞–∑ –≤ –ø–æ–ª, –ø–æ–∫–∞ –Ω–µ –≤—Ä–µ–∂–µ—Ç—Å—è –≤ –±–∞–º–ø–µ—Ä –ø–µ—Ä–µ–¥–Ω–µ–π –º–∞—à–∏–Ω—ã (–ø–æ—Ç–µ—Ä—è –ø–∞–∫–µ—Ç–∞). –ü–æ—Ç–æ–º —Ä–µ–∑–∫–æ —Ç–æ—Ä–º–æ–∑–∏—Ç. –ï–∑–¥–∞ —Ä–≤–∞–Ω–∞—è, –ø—Ä–æ–±–∫–∏ (–±—É—Ñ–µ—Ä—ã) –ø–ª–æ—Ç–Ω—ã–µ.
*   **BBR (–ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –∫—Ä—É–∏–∑-–∫–æ–Ω—Ç—Ä–æ–ª—å):**
    1.  –ò–∑–º–µ—Ä—è–µ—Ç —Å–∫–æ—Ä–æ—Å—Ç—å –ø–æ—Ç–æ–∫–∞ (**Max BW**).
    2.  –ò–∑–º–µ—Ä—è–µ—Ç –¥–∏—Å—Ç–∞–Ω—Ü–∏—é (**Min RTT**).
    3.  –î–µ—Ä–∂–∏—Ç –∏–¥–µ–∞–ª—å–Ω—É—é –¥–∏—Å—Ç–∞–Ω—Ü–∏—é, –Ω–µ —Å–æ–∑–¥–∞–≤–∞—è –ø—Ä–æ–±–∫–∏.

**–ì–ª–∞–≤–Ω–æ–µ –æ—Ç–ª–∏—á–∏–µ ‚Äî Pacing (–ü–µ–π—Å–∏–Ω–≥):** BBR –Ω–µ –≤—ã–ø–ª–µ–≤—ã–≤–∞–µ—Ç –ø–∞–∫–µ—Ç—ã –ø–∞—á–∫–∞–º–∏. –û–Ω —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –∏–¥–µ–∞–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª. –ï—Å–ª–∏ –∫–∞–Ω–∞–ª 100 –ú–±–∏—Ç/—Å, –æ–Ω –±—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –ø–∞–∫–µ—Ç—ã —Å—Ç—Ä–æ–≥–æ –∫–∞–∂–¥—ã–µ `X` –º–∏–∫—Ä–æ—Å–µ–∫—É–Ω–¥, —á—Ç–æ–±—ã –æ–Ω–∏ —à–ª–∏ ¬´–≤–∞–≥–æ–Ω—á–∏–∫–∞–º–∏¬ª, –Ω–µ —Å–∫–∞–ø–ª–∏–≤–∞—è—Å—å –≤ –∫—É—á—É –Ω–∞ —É–∑–∫–æ–º –º–µ—Å—Ç–µ.

**–ü—Ä–∞–∫—Ç–∏–∫–∞:** –í Linux (—è–¥—Ä–æ 4.9+) BBR –≤–∫–ª—é—á–∞–µ—Ç—Å—è —Ç–∞–∫:

```
echo "net.core.default_qdisc=fq" >> /etc/sysctl.conf
echo "net.ipv4.tcp_congestion_control=bbr" >> /etc/sysctl.conf
sysctl -p
```

_–í–∞–∂–Ω–æ:_ BBR —Ç—Ä–µ–±—É–µ—Ç –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞ –ø–∞–∫–µ—Ç–æ–≤ `fq` (Fair Queueing), —á—Ç–æ–±—ã —Ä–∞–±–æ—Ç–∞–ª–∞ –º–∞–≥–∏—è –ø–µ–π—Å–∏–Ω–≥–∞. –ë–µ–∑ `fq` BBR —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —Ä–µ–∂–∏–º–µ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ –∏ –≥–æ—Ä–∞–∑–¥–æ —Ö—É–∂–µ.

* * *

–ß–∞—Å—Ç—å 2.3: –†–µ—à–µ–Ω–∏–µ –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ –†–æ—É—Ç–µ—Ä–∞ (AQM & SQM)
-------------------------------------------------

–ï—Å–ª–∏ –≤—ã –Ω–µ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç–µ —Å–µ—Ä–≤–µ—Ä (–æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è), –≤—ã –¥–æ–ª–∂–Ω—ã –ª–µ—á–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—É –Ω–∞ —Å–≤–æ–µ–π —Å—Ç–æ—Ä–æ–Ω–µ (–Ω–∞ —Ä–æ—É—Ç–µ—Ä–µ). –≠—Ç–æ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è **AQM (Active Queue Management)**.

### –≠–≤–æ–ª—é—Ü–∏—è –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤ –æ—á–∏—Å—Ç–∫–∏ –æ—á–µ—Ä–µ–¥–∏:

1.  **Drop Tail (–¢—É–ø–æ–π –ø–æ–¥—Ö–æ–¥):** –ë—É—Ñ–µ—Ä 100%. –°–ª–µ–¥—É—é—â–∏–π –ø–∞–∫–µ—Ç –¥—Ä–æ–ø–∞–µ—Ç—Å—è. (–ü—Ä–∏—á–∏–Ω–∞ –≥–ª–æ–±–∞–ª—å–Ω–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ TCP –∏ –¥–∏–∫–∏—Ö –ª–∞–≥–æ–≤).
2.  **RED (Random Early Detection):** –ù–∞—á–∏–Ω–∞–µ–º –¥—Ä–æ–ø–∞—Ç—å —Å–ª—É—á–∞–π–Ω—ã–µ –ø–∞–∫–µ—Ç—ã, –∫–æ–≥–¥–∞ –±—É—Ñ–µ—Ä –∑–∞–ø–æ–ª–Ω–µ–Ω –Ω–∞ 50%. _–°–ª–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å, —É—Å—Ç–∞—Ä–µ–ª._
3.  **CoDel (Controlled Delay):** ¬´–ï—Å–ª–∏ –ø–∞–∫–µ—Ç –ª–µ–∂–∏—Ç –≤ –æ—á–µ—Ä–µ–¥–∏ –¥–æ–ª—å—à–µ 5 –º—Å ‚Äî —É–±–µ–π –µ–≥–æ¬ª.
    *   –ñ–µ—Å—Ç–æ–∫–æ? –î–∞.
    *   –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ? –ù–µ–≤–µ—Ä–æ—è—Ç–Ω–æ. TCP –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—å –≤–∏–¥–∏—Ç –ø–æ—Ç–µ—Ä—é –∏ —Å–Ω–∏–∂–∞–µ—Ç —Å–∫–æ—Ä–æ—Å—Ç—å _–¥–æ —Ç–æ–≥–æ_, –∫–∞–∫ —Å–æ–∑–¥–∞—Å—Ç –ø—Ä–æ–±–∫—É.

### –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π —Å—Ç–∞–Ω–¥–∞—Ä—Ç: FQ\_CoDel –∏ CAKE

**FQ\_CoDel (Fair Queueing + Controlled Delay):** –≠—Ç–æ –º–∞–≥–∏—è, –∫–æ—Ç–æ—Ä–∞—è –¥–µ–ª–∞–µ—Ç —Ç–µ—Å—Ç Waveform –∏–¥–µ–∞–ª—å–Ω—ã–º (A+).

1.  **Hashing:** –û–Ω —Ä–∞–∑–±–∏–≤–∞–µ—Ç —Ç—Ä–∞—Ñ–∏–∫ –Ω–∞ –ø–æ—Ç–æ–∫–∏ (flows). –í–∞—à —Ç–æ—Ä—Ä–µ–Ω—Ç ‚Äî —ç—Ç–æ –æ–¥–∏–Ω –ø–æ—Ç–æ–∫, –≤–∞—à –∑—É–º ‚Äî –¥—Ä—É–≥–æ–π, –≤–∞—à–∞ –∏–≥—Ä–∞ ‚Äî —Ç—Ä–µ—Ç–∏–π.
2.  **Round Robin:** –û–Ω –±–µ—Ä–µ—Ç –ø–æ –æ–¥–Ω–æ–º—É –ø–∞–∫–µ—Ç—É –∏–∑ –∫–∞–∂–¥–æ–π –æ—á–µ—Ä–µ–¥–∏ –ø–æ –∫—Ä—É–≥—É.
3.  **–ò—Ç–æ–≥:** –ñ–∏—Ä–Ω—ã–π –ø–æ—Ç–æ–∫ (—Å–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞) –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –∑–∞–±–ª–æ–∫–∏—Ä—É–µ—Ç —Ç–æ–Ω–∫–∏–π –ø–æ—Ç–æ–∫ (–ø–∏–Ω–≥ –≤ –∏–≥—Ä–µ). –ü–∞–∫–µ—Ç —Å –∏–≥—Ä–æ–π –ø—Ä–æ—Å–∫–æ—á–∏—Ç –≤–ø–µ—Ä–µ–¥ –æ—á–µ—Ä–µ–¥–∏ –º–æ–Ω—Å—Ç—Ä–∞-—Å–∫–∞—á–∏–≤–∞–Ω–∏—è.

**CAKE (Common Applications Kept Enhanced):** –≠—Ç–æ FQ\_CoDel –Ω–∞ —Å—Ç–µ—Ä–æ–∏–¥–∞—Ö, –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –≤ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ä–æ—É—Ç–µ—Ä—ã (OpenWrt). –û–Ω –ø–æ–Ω–∏–º–∞–µ—Ç NAT –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –µ—â–µ –º—è–≥—á–µ.

* * *

üî¨ –õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞—è —Ä–∞–±–æ—Ç–∞ (Homework)
---------------------------------

–í—ã –ø—Ä–∏—Å–ª–∞–ª–∏ —Å—Å—ã–ª–∫—É –Ω–∞ —Ç–µ—Å—Ç. –¢–µ–ø–µ—Ä—å, –∫–∞–∫ –ø—Ä–æ—Ñ–∏, –≤—ã –¥–æ–ª–∂–Ω—ã –∏–∑–º–µ–Ω–∏—Ç—å —ç—Ç–æ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç.

1.  **–ó–∞–¥–∞—á–∞:** –ü–æ–ª—É—á–∏—Ç—å **A+** –≤ —Ç–µ—Å—Ç–µ Waveform (–∏–ª–∏ Bufferbloat grade A).
2.  **–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç:**
    *   –ï—Å–ª–∏ —É –≤–∞—Å Linux-—Ä–æ—É—Ç–µ—Ä (–∏–ª–∏ OpenWrt): –ù–∞—Å—Ç—Ä–æ–π—Ç–µ **SQM (Smart Queue Management)**. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∞–ª–≥–æ—Ä–∏—Ç–º `cake` –∏–ª–∏ `piece_of_cake`.
    *   _–¢—Ä—é–∫:_ –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ª–∏–º–∏—Ç —Å–∫–æ—Ä–æ—Å—Ç–∏ –Ω–∞ 90-95% –æ—Ç –≤–∞—à–µ–π —Ä–µ–∞–ª—å–Ω–æ–π —Å–∫–æ—Ä–æ—Å—Ç–∏ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞.
    *   _–ü–æ—á–µ–º—É:_ –í—ã –¥–æ–ª–∂–Ω—ã —Å—Ç–∞—Ç—å ¬´–±—É—Ç—ã–ª–æ—á–Ω—ã–º –≥–æ—Ä–ª—ã—à–∫–æ–º¬ª –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω–æ. –¢–æ–≥–¥–∞ –æ—á–µ—Ä–µ–¥—å –±—É–¥–µ—Ç –∫–æ–ø–∏—Ç—å—Å—è —É –≤–∞—Å –≤ `fq_codel` (–≥–¥–µ –≤—ã –µ—é —É–ø—Ä–∞–≤–ª—è–µ—Ç–µ), –∞ –Ω–µ —É –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ –≤ —Ç—É–ø–æ–º –±—É—Ñ–µ—Ä–µ (–≥–¥–µ –≤—ã –±–µ—Å—Å–∏–ª—å–Ω—ã).
3.  **–°—Ä–∞–≤–Ω–µ–Ω–∏–µ:**
    *   –°–¥–µ–ª–∞–π—Ç–µ —Ç–µ—Å—Ç –±–µ–∑ SQM. –ó–∞–ø–∏—à–∏—Ç–µ "Loaded Latency".
    *   –°–¥–µ–ª–∞–π—Ç–µ —Ç–µ—Å—Ç —Å SQM + CAKE.
    *   –†–∞–∑–Ω–∏—Ü–∞ –±—É–¥–µ—Ç —à–æ–∫–∏—Ä—É—é—â–µ–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, 200ms -\> 5ms).

–≠—Ç–æ –∏ –µ—Å—Ç—å –∏–Ω–∂–µ–Ω–µ—Ä–Ω—ã–π –ø–æ–¥—Ö–æ–¥: –º—ã –∂–µ—Ä—Ç–≤—É–µ–º 5% –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π —Å–∫–æ—Ä–æ—Å—Ç–∏ (Throughput), —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –∏–¥–µ–∞–ª—å–Ω—É—é –æ—Ç–∑—ã–≤—á–∏–≤–æ—Å—Ç—å (Latency).

* * *

–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥ ‚Äî **–ú–æ–¥—É–ª—å 3: –¢—é–Ω–∏–Ω–≥ –∏ –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞**. –¢–∞–º –º—ã –≤–æ–∑—å–º–µ–º `tc` (Traffic Control) –∏ –ø–æ—Å–º–æ—Ç—Ä–∏–º, –∫–∞–∫ –∏–º–µ–Ω–Ω–æ –≤—ã–≥–ª—è–¥—è—Ç —ç—Ç–∏ –æ—á–µ—Ä–µ–¥–∏ –≤ —è–¥—Ä–µ.

–ì–æ—Ç–æ–≤—ã –∫–æ–ø–∞—Ç—å –≥–ª—É–±–∂–µ?

[How to Fix Bufferbloat for Gaming](https://www.youtube.com/watch?v=97qPzYFJ3N0)
 –≠—Ç–æ—Ç —Ä–æ–ª–∏–∫ –Ω–∞–≥–ª—è–¥–Ω–æ –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç –≤–ª–∏—è–Ω–∏–µ Bufferbloat –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (–∏–≥—Ä—ã) –∏ –æ–±—ä—è—Å–Ω—è–µ—Ç –∫–æ–Ω—Ü–µ–ø—Ü–∏—é SQM, –æ –∫–æ—Ç–æ—Ä–æ–π –º—ã –≥–æ–≤–æ—Ä–∏–ª–∏ –≤ –º–æ–¥—É–ª–µ.

## Prompt:
–î–∞–≤–∞–π –¥–∞–ª—å—à–µ.

## Response:
–û—Ç–ª–∏—á–Ω–æ. –ú—ã —Ä–∞–∑–æ–±—Ä–∞–ª–∏—Å—å —Å —Ñ–∏–∑–∏–∫–æ–π (–ú–æ–¥—É–ª—å 1) –∏ –∞–ª–≥–æ—Ä–∏—Ç–º–∞–º–∏ (–ú–æ–¥—É–ª—å 2). –¢–µ–ø–µ—Ä—å –ø–µ—Ä–µ—Ö–æ–¥–∏–º –∫ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º, –∫–æ—Ç–æ—Ä—ã–µ –æ—Ç–ª–∏—á–∞—é—Ç ¬´—ç–Ω–∏–∫–µ–π—â–∏–∫–∞¬ª –æ—Ç SRE-–∏–Ω–∂–µ–Ω–µ—Ä–∞.

–ú–æ–¥—É–ª—å 3: –¢—é–Ω–∏–Ω–≥ –∏ –ì–ª—É–±–æ–∫–∞—è –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ (–•–∏—Ä—É—Ä–≥–∏—è)
==================================================

_¬´Wireshark ‚Äî —ç—Ç–æ –ø–∞—Ç–æ–ª–æ–≥–æ–∞–Ω–∞—Ç–æ–º. –û–Ω –≥–æ–≤–æ—Ä–∏—Ç, –ø–æ—á–µ–º—É –ø–∞—Ü–∏–µ–Ω—Ç —É–º–µ—Ä. –ù–∞–º –Ω—É–∂–Ω—ã –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã —Ö–∏—Ä—É—Ä–≥–∞, —á—Ç–æ–±—ã —Å–ø–∞—Å—Ç–∏ –µ–≥–æ, –ø–æ–∫–∞ –æ–Ω –∂–∏–≤¬ª._

–í —ç—Ç–æ–º –º–æ–¥—É–ª–µ –º—ã –æ—Ç–ª–æ–∂–∏–º GUI –∏ –≤–æ–∑—å–º–µ–º –≤ —Ä—É–∫–∏ —Å–∫–∞–ª—å–ø–µ–ª—å: `tc`, `sysctl` –∏ `eBPF`.

* * *

–ß–∞—Å—Ç—å 3.1: Traffic Control (`tc`) ‚Äî –†–µ–∂–∏–º –ë–æ–≥–∞
----------------------------------------------

Linux Kernel ‚Äî —ç—Ç–æ –Ω–µ –ø—Ä–æ—Å—Ç–æ —Å–µ—Ç–µ–≤–æ–π —Å—Ç–µ–∫, —ç—Ç–æ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä—É–µ–º—ã–π —Ä–æ—É—Ç–µ—Ä. –£—Ç–∏–ª–∏—Ç–∞ `tc` (Traffic Control) —É–ø—Ä–∞–≤–ª—è–µ—Ç —Ç–µ–º, –∫–∞–∫ –ø–∞–∫–µ—Ç—ã –ø–æ–∫–∏–¥–∞—é—Ç –≤–∞—à —Å–µ—Ä–≤–µ—Ä (Egress).

### –ú–µ–Ω—Ç–∞–ª—å–Ω–∞—è –º–æ–¥–µ–ª—å: Qdisc (Queueing Discipline)

–ü—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ –≤—ã–µ–∑–¥ —Å –ø–∞—Ä–∫–æ–≤–∫–∏.

*   **Classless Qdisc:** –í—Å–µ –º–∞—à–∏–Ω—ã —Ä–∞–≤–Ω—ã. –ö—Ç–æ –ø–µ—Ä–≤—ã–π –≤—Å—Ç–∞–ª, —Ç–æ—Ç –ø–µ—Ä–≤—ã–π –≤—ã–µ—Ö–∞–ª (`pfifo_fast`).
*   **Classful Qdisc:** VIP-–≤—ã–µ–∑–¥ –¥–ª—è Ferrari (VoIP), –æ–±—â–∏–π –¥–ª—è Toyota (Web), –∏ –≥—Ä–∞–≤–∏–π–∫–∞ –¥–ª—è –≥—Ä—É–∑–æ–≤–∏–∫–æ–≤ (Torrents).

### Chaos Engineering —Å –ø–æ–º–æ—â—å—é `netem`

–ö–∞–∫ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å, –≤—ã–¥–µ—Ä–∂–∏—Ç –ª–∏ –≤–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–ª–æ—Ö–æ–π Wi-Fi, –Ω–µ –≤—ã—Ö–æ–¥—è –∏–∑ –æ—Ñ–∏—Å–∞? –ú—ã –∏—Å–ø–æ—Ä—Ç–∏–º —Å–µ—Ç—å —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ.

**–°—Ü–µ–Ω–∞—Ä–∏–π:** –≠–º—É–ª—è—Ü–∏—è 4G —Å–µ—Ç–∏ —Å –ø–æ—Ç–µ—Ä—è–º–∏.

```
# –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–¥–µ—Ä–∂–∫—É 100–º—Å ¬± 20–º—Å (–Ω–æ—Ä–º–∞–ª—å–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ)
tc qdisc add dev eth0 root netem delay 100ms 20ms distribution normal

# –î–æ–±–∞–≤–ª—è–µ–º 1% –ø–æ—Ç–µ—Ä—å –ø–∞–∫–µ—Ç–æ–≤
tc qdisc change dev eth0 root netem delay 100ms 20ms loss 1%

# –î–æ–±–∞–≤–ª—è–µ–º –¥—É–±–ª–∏–∫–∞—Ç—ã –∏ –ø–µ—Ä–µ—É–ø–æ—Ä—è–¥–æ—á–∏–≤–∞–Ω–∏–µ (–∞–¥ –¥–ª—è TCP —Å—Ç–µ–∫–∞)
tc qdisc change dev eth0 root netem delay 100ms reorder 25% 50%
```

_–ó–∞—á–µ–º —ç—Ç–æ –Ω—É–∂–Ω–æ:_ –ï—Å–ª–∏ –≤–∞—à —Å–µ—Ä–≤–∏—Å –ø–∞–¥–∞–µ—Ç –∏–ª–∏ –≤–∏—Å–Ω–µ—Ç –ø—Ä–∏ –ø–æ—Ç–µ—Ä–µ 1% –ø–∞–∫–µ—Ç–æ–≤ ‚Äî –µ–≥–æ –Ω–µ–ª—å–∑—è –ø—É—Å–∫–∞—Ç—å –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω. –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ —Ç–∞–π–º–∞—É—Ç—ã –∏ —Ä–µ—Ç—Ä–∞–∏ **–¥–æ** —Ä–µ–ª–∏–∑–∞.

_–°–±—Ä–æ—Å –Ω–∞—Å—Ç—Ä–æ–µ–∫:_ `tc qdisc del dev eth0 root`

* * *

–ß–∞—Å—Ç—å 3.2: –ú–∏–∫—Ä–æ–±–µ—Ä—Å—Ç—ã (The Invisible Assassin)
-----------------------------------------------

–í—ã —Å–º–æ—Ç—Ä–∏—Ç–µ –≤ Zabbix/Prometheus: –∑–∞–≥—Ä—É–∑–∫–∞ –∫–∞–Ω–∞–ª–∞ 500 Mbps –ø—Ä–∏ –ª–∏–Ω–∫–µ 1 Gbps. –ù–æ –ø–∞–∫–µ—Ç—ã –¥—Ä–æ–ø–∞—é—Ç—Å—è. –ü–æ—á–µ–º—É? **–û—Ç–≤–µ—Ç:** –í—ã —Å–º–æ—Ç—Ä–∏—Ç–µ –Ω–∞ —Å—Ä–µ–¥–Ω–µ–µ –∑–∞ 1 —Å–µ–∫—É–Ω–¥—É.

### –ú–µ–Ω—Ç–∞–ª—å–Ω–∞—è –º–æ–¥–µ–ª—å: –õ–∞–∑–µ—Ä–Ω–∞—è —É–∫–∞–∑–∫–∞ vs –ü—Ä–æ–∂–µ–∫—Ç–æ—Ä

–ì—Ä–∞—Ñ–∏–∫–∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ ‚Äî —ç—Ç–æ –ø—Ä–æ–∂–µ–∫—Ç–æ—Ä, –æ–Ω "—Ä–∞–∑–º–∞–∑—ã–≤–∞–µ—Ç" —Å–≤–µ—Ç. –†–µ–∞–ª—å–Ω—ã–π —Ç—Ä–∞—Ñ–∏–∫ ‚Äî —ç—Ç–æ –≤—Å–ø—ã—à–∫–∏ –ª–∞–∑–µ—Ä–∞.

*   –í —Ç–µ—á–µ–Ω–∏–µ 100 –º—Å –ø—Ä–∏–ª–µ—Ç–∞–µ—Ç –ø–∞—á–∫–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —Å–∫–æ—Ä–æ—Å—Ç–∏ 10 Gbps. –ë—É—Ñ–µ—Ä –ø–µ—Ä–µ–ø–æ–ª–Ω—è–µ—Ç—Å—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ.
*   –°–ª–µ–¥—É—é—â–∏–µ 900 –º—Å ‚Äî —Ç–∏—à–∏–Ω–∞.
*   **–°—Ä–µ–¥–Ω–µ–µ –∑–∞ —Å–µ–∫—É–Ω–¥—É:** 1 Gbps. –í—Å—ë –≤—ã–≥–ª—è–¥–∏—Ç –æ–∫.
*   **–†–µ–∞–ª—å–Ω–æ—Å—Ç—å:** –î—Ä–æ–ø—ã –ø–∞–∫–µ—Ç–æ–≤ –∏ —Ç–æ—Ä–º–æ–∑–∞.

### –ö–∞–∫ –ø–æ–π–º–∞—Ç—å –ú–∏–∫—Ä–æ–±–µ—Ä—Å—Ç?

–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —É—Ç–∏–ª–∏—Ç—ã —Å–ª–∏—à–∫–æ–º –º–µ–¥–ª–µ–Ω–Ω—ã–µ.

1.  **–°–º–æ—Ç—Ä–∏–º –¥—Ä–æ–ø—ã –æ—á–µ—Ä–µ–¥–µ–π:**
    ```
    tc -s qdisc show dev eth0
    ```
    –ò—â–∏—Ç–µ –ø–æ–ª–µ `dropped`. –ï—Å–ª–∏ —Å—á–µ—Ç—á–∏–∫ —Ä–∞—Å—Ç–µ—Ç, –∞ —Å—Ä–µ–¥–Ω—è—è –∑–∞–≥—Ä—É–∑–∫–∞ –Ω–∏–∑–∫–∞—è ‚Äî —ç—Ç–æ –º–∏–∫—Ä–æ–±–µ—Ä—Å—Ç—ã.
2.  **–†–µ—à–µ–Ω–∏–µ:**
    *   –£–≤–µ–ª–∏—á–∏—Ç—å –±—É—Ñ–µ—Ä—ã (`txqueuelen`), –ø–æ–∂–µ—Ä—Ç–≤–æ–≤–∞–≤ latency (–ø–ª–æ—Ö–æ).
    *   –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **BBR** (–æ–Ω —Å–≥–ª–∞–∂–∏–≤–∞–µ—Ç –ø–∏–∫–∏ –∑–∞ —Å—á–µ—Ç Pacing).
    *   –®–µ–π–ø–∏—Ç—å —Ç—Ä–∞—Ñ–∏–∫ –Ω–∞ –æ—Ç–ø—Ä–∞–≤–∫–µ —á—É—Ç—å –Ω–∏–∂–µ –ª–∏–º–∏—Ç–∞, —á—Ç–æ–±—ã —Å–≥–ª–∞–¥–∏—Ç—å ¬´–≤–∑—Ä—ã–≤—ã¬ª.

* * *

–ß–∞—Å—Ç—å 3.3: eBPF –∏ BCC ‚Äî –†–µ–Ω—Ç–≥–µ–Ω —è–¥—Ä–∞
------------------------------------

–ö–æ–≥–¥–∞ `tcpdump` –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–∏—á–∏–Ω—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∑–∞–¥–µ—Ä–∂–∫–∞ –≤–Ω—É—Ç—Ä–∏ —Å–∞–º–æ–≥–æ —è–¥—Ä–∞), –Ω–∞ —Å—Ü–µ–Ω—É –≤—ã—Ö–æ–¥–∏—Ç **eBPF** (extended Berkeley Packet Filter). –≠—Ç–æ —Å–ø–æ—Å–æ–± –±–µ–∑–æ–ø–∞—Å–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –≤–∞—à –∫–æ–¥ –ø—Ä—è–º–æ –≤–Ω—É—Ç—Ä–∏ —è–¥—Ä–∞ Linux –±–µ–∑ –ø–µ—Ä–µ–∫–æ–º–ø–∏–ª—è—Ü–∏–∏.

–ú—ã –Ω–µ –±—É–¥–µ–º –ø–∏—Å–∞—Ç—å –∫–æ–¥ –Ω–∞ C, –º—ã –≤–æ–∑—å–º–µ–º –≥–æ—Ç–æ–≤—ã–π –Ω–∞–±–æ—Ä **BCC Tools** (`apt install bpfcc-tools`).

### –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã must-have:

1.  **`tcpretrans`** ‚Äî –ö—Ç–æ —Ç–µ—Ä—è–µ—Ç –ø–∞–∫–µ—Ç—ã? –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–∞–∂–¥—ã–π —Ä–µ—Ç—Ä–∞–Ω—Å–º–∏—Ç –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ —Å —É–∫–∞–∑–∞–Ω–∏–µ–º _–ø—Ä–∏—á–∏–Ω—ã_ (–µ—Å–ª–∏ —è–¥—Ä–æ –∑–Ω–∞–µ—Ç).
    ```
    # tcpretrans
    TIME     PID    LADDR:LPORT  -> RADDR:RPORT  STATE
    10:00:01 1234   10.0.0.1:22  -> 192.168.1.5  ESTABLISHED
    ```
2.  **`tcplife`** ‚Äî –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∂–∏–∑–Ω–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç, —Å–∫–æ–ª—å–∫–æ –±–∞–π—Ç –ø–µ—Ä–µ–¥–∞–Ω–æ, —Å–∫–æ–ª—å–∫–æ –¥–ª–∏–ª–æ—Å—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∏ (–≤–∞–∂–Ω–æ!) **RTT**. _–ò–¥–µ–∞–ª—å–Ω–æ –¥–ª—è –ø–æ–∏—Å–∫–∞ –º–µ–¥–ª–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –ë–î._
3.  **`tcpconnlat`** ‚Äî –ó–∞–¥–µ—Ä–∂–∫–∞ —Ä—É–∫–æ–ø–æ–∂–∞—Ç–∏—è (Handshake Latency). –°–∫–æ–ª—å–∫–æ –≤—Ä–µ–º–µ–Ω–∏ –ø—Ä–æ—à–ª–æ –æ—Ç SYN –¥–æ ACK. –ï—Å–ª–∏ —Ç—É—Ç –∑–∞–¥–µ—Ä–∂–∫–∏ ‚Äî –ø—Ä–æ–±–ª–µ–º–∞ –≤ –ø–µ—Ä–µ–≥—Ä—É–∑–∫–µ CPU –Ω–∞ –ø—Ä–∏–µ–º–Ω–æ–π —Å—Ç–æ—Ä–æ–Ω–µ (backlog queue overflow).

* * *

–ß–∞—Å—Ç—å 3.4: Sysctl Tuning ‚Äî –û–ø–∞—Å–Ω–∞—è –∑–æ–Ω–∞
---------------------------------------

–ò–Ω—Ç–µ—Ä–Ω–µ—Ç –ø–æ–ª–æ–Ω –≤—Ä–µ–¥–Ω—ã—Ö —Å–æ–≤–µ—Ç–æ–≤ (¬´–°–∫–æ–ø–∏—Ä—É–π —ç—Ç–∏ 20 —Å—Ç—Ä–æ–∫ –≤ sysctl.conf, –∏ —Å–µ—Ç—å –ø–æ–ª–µ—Ç–∏—Ç¬ª). –†–∞–∑–±–µ—Ä–µ–º –≥–ª–∞–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã.

### 1\. –ë—É—Ñ–µ—Ä—ã –ø–∞–º—è—Ç–∏ (`tcp_rmem`, `tcp_wmem`)

–§–æ—Ä–º–∞—Ç: `min default max`.

*   **–û—à–∏–±–∫–∞ –Ω–æ–≤–∏—á–∫–∞:** –°—Ç–∞–≤–∏—Ç—å –æ–≥—Ä–æ–º–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è `min` –∏ `default`. –≠—Ç–æ –∑–∞—Å—Ç–∞–≤–∏—Ç —è–¥—Ä–æ –≤—ã–¥–µ–ª—è—Ç—å –º–µ–≥–∞–±–∞–π—Ç—ã –ø–∞–º—è—Ç–∏ –Ω–∞ –∫–∞–∂–¥–æ–µ idle-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ. –ü—Ä–∏ 10k —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π —Å–µ—Ä–≤–µ—Ä —É–ø–∞–¥–µ—Ç –≤ OOM (Out Of Memory).
*   **–ü—Ä–∞–≤–∏–ª–æ:** –¢—Ä–æ–≥–∞–π—Ç–µ —Ç–æ–ª—å–∫–æ `max`. –ü–æ–∑–≤–æ–ª—å—Ç–µ —è–¥—Ä—É (Autotuning) —Å–∞–º–æ–º—É –≤—ã–±–∏—Ä–∞—Ç—å —Ä–∞–∑–º–µ—Ä –≤ —Ä–∞–º–∫–∞—Ö –æ—Ç `min` –¥–æ `max`.
*   _–†–∞—Å—á–µ—Ç:_ `Max Buffer = Bandwidth (Bps) * RTT (sec)`. –î–ª—è 10Gbps –∏ 100ms RTT –Ω—É–∂–Ω–æ ~125 MB.

### 2\. TIME\_WAIT Assassination

*   **`net.ipv4.tcp_tw_reuse = 1`**: **–í–ö–õ–Æ–ß–ò–¢–¨.** –ü–æ–∑–≤–æ–ª—è–µ—Ç –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–æ–∫–µ—Ç—ã –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ TIME\_WAIT –¥–ª—è _–∏—Å—Ö–æ–¥—è—â–∏—Ö_ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π, –µ—Å–ª–∏ —Ç–∞–π–º—Å—Ç–∞–º–ø—ã –≥–æ–≤–æ—Ä—è—Ç, —á—Ç–æ —ç—Ç–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ. –°–ø–∞—Å–∞–µ—Ç –ø—Ä–∏ –≤—ã—Å–æ–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–µ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ (–ø—Ä–æ–∫—Å–∏, Nginx).
*   **`net.ipv4.tcp_tw_recycle`**: **–ó–ê–ë–´–¢–¨ –ò –ù–ï –¢–†–û–ì–ê–¢–¨.** –≠—Ç–æ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä –ª–æ–º–∞–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –¥–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤ –∑–∞ NAT (–æ—Ñ–∏—Å—ã, –º–æ–±–∏–ª—å–Ω—ã–µ —Å–µ—Ç–∏). –£–¥–∞–ª–µ–Ω –∏–∑ –Ω–æ–≤—ã—Ö —è–¥–µ—Ä, –Ω–æ –≤ —Å—Ç–∞—Ä—ã—Ö –≥–∞–π–¥–∞—Ö –≤—Å–ø–ª—ã–≤–∞–µ—Ç.

### 3\. SYN Cookies

*   **`net.ipv4.tcp_syncookies = 1`**: –í–∫–ª—é—á–∏—Ç—å. –≠—Ç–æ –∑–∞—â–∏—Ç–∞ –æ—Ç SYN Flood –∞—Ç–∞–∫. –ï—Å–ª–∏ –æ—á–µ—Ä–µ–¥—å –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∞, —è–¥—Ä–æ –Ω–µ –∑–∞–ø–æ–º–∏–Ω–∞–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ, –∞ —à–∏—Ñ—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ Sequence Number.

* * *

üõ† –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ (Homework)
----------------------------------

–ü–æ—á—É–≤—Å—Ç–≤—É–π—Ç–µ —Å–µ–±—è —Å–µ—Ç–µ–≤—ã–º —Ö–∏—Ä—É—Ä–≥–æ–º.

1.  **–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞:** –ó–∞–ø—É—Å—Ç–∏—Ç–µ `ping 8.8.8.8` –≤ –æ–¥–Ω–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ –±–æ–ª—å—à–æ–≥–æ —Ñ–∞–π–ª–∞ (`wget ...`) –≤ –¥—Ä—É–≥–æ–º.
2.  **–í–º–µ—à–∞—Ç–µ–ª—å—Å—Ç–≤–æ (Chaos):** –ü—Ä–∏–º–µ–Ω–∏—Ç–µ –ø—Ä–∞–≤–∏–ª–æ `tc`, –¥–æ–±–∞–≤–ª—è—é—â–µ–µ 200ms –∑–∞–¥–µ—Ä–∂–∫–∏ –∏ 5% –ø–æ—Ç–µ—Ä—å –ø–∞–∫–µ—Ç–æ–≤ –Ω–∞ –≤–∞—à –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å.
    ```
    tc qdisc add dev eth0 root netem delay 200ms loss 5%
    ```
    _–ù–∞–±–ª—é–¥–∞–π—Ç–µ:_ –ö–∞–∫ –∏–∑–º–µ–Ω–∏–ª–∞—Å—å —Å–∫–æ—Ä–æ—Å—Ç—å —Å–∫–∞—á–∏–≤–∞–Ω–∏—è? –ü–µ—Ä–µ—Å—Ç–∞–ª –ª–∏ —Ä–∞–±–æ—Ç–∞—Ç—å ping?
3.  **–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ (X-Ray):** –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ `bpfcc-tools` (–∏–ª–∏ `bcc-tools`). –ó–∞–ø—É—Å—Ç–∏—Ç–µ `sudo tcpretrans`. –í—ã –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å –ø–æ—Ç–æ–∫ —Å–æ–æ–±—â–µ–Ω–∏–π –æ —Ä–µ—Ç—Ä–∞–Ω—Å–º–∏—Ç–∞—Ö. –°—Ä–∞–≤–Ω–∏—Ç–µ –∏—Ö —á–∞—Å—Ç–æ—Ç—É —Å –≤–∞—à–∏–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –ø–æ—Ç–µ—Ä—å.
4.  **–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ:** –£–¥–∞–ª–∏—Ç–µ –ø—Ä–∞–≤–∏–ª–æ `tc`:
    ```
    tc qdisc del dev eth0 root
    ```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –í—ã —É–≤–∏–¥–µ–ª–∏, –∫–∞–∫ –ø–æ—Ç–µ—Ä—è –ø–∞–∫–µ—Ç–æ–≤ —É–±–∏–≤–∞–µ—Ç TCP throughput (–∏–∑-–∑–∞ –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤ Congestion Control, –∏–∑—É—á–µ–Ω–Ω—ã—Ö –≤ –ú–æ–¥—É–ª–µ 2), –∏ –Ω–∞—É—á–∏–ª–∏—Å—å –≤–∏–¥–µ—Ç—å —ç—Ç–æ –≥–ª–∞–∑–∞–º–∏ —è–¥—Ä–∞ —á–µ—Ä–µ–∑ eBPF.

* * *

_–≠—Ç–æ –±—ã–ª —Å–∞–º—ã–π —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏ –Ω–∞—Å—ã—â–µ–Ω–Ω—ã–π –º–æ–¥—É–ª—å. –î–∞–ª—å—à–µ —É –Ω–∞—Å –ú–æ–¥—É–ª—å 4: –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π. –ú—ã –ø–æ–¥–Ω–∏–º–µ–º—Å—è –∏–∑ —è–¥—Ä–∞ –≤ User Space –∏ –ø–æ–≥–æ–≤–æ—Ä–∏–º –ø—Ä–æ Zero-Copy, io\_uring –∏ C# Pipelines. –ì–æ—Ç–æ–≤—ã?_

## Prompt:
–ü–æ–¥–æ–∂–¥–∏. –ê –Ω–∞–ø–∏—à–∏ –∫–∞–∫–æ–π –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω—ã–π —Å—Ç–µ–Ω–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å?

## Response:
–í–æ–ø—Ä–æ—Å –≤ —Å–∞–º–æ–µ —è–±–ª–æ—á–∫–æ. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–µ—Ç–µ–≤—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã –Ω–∞ `localhost` ‚Äî —ç—Ç–æ —Å–∞–º–æ–æ–±–º–∞–Ω. –ü–∞–∫–µ—Ç—ã –ø—Ä–æ—Å—Ç–æ –∫–æ–ø–∏—Ä—É—é—Ç—Å—è –≤ –ø–∞–º—è—Ç–∏, –º–∏–Ω—É—è —Å–µ—Ç–µ–≤–æ–π —Å—Ç–µ–∫, NIC, –æ—á–µ—Ä–µ–¥–∏ –∏ —Ä–µ–∞–ª—å–Ω—ã–µ –∑–∞–¥–µ—Ä–∂–∫–∏.

–ß—Ç–æ–±—ã –æ—Ç—Ä–∞–±–æ—Ç–∞—Ç—å –≤—Å–µ –∫–µ–π—Å—ã –∏–∑ –∫—É—Ä—Å–∞ (–æ—Å–æ–±–µ–Ω–Ω–æ `tc`, BBR –∏ eBPF), –Ω–∞–º –Ω—É–∂–µ–Ω **–∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–ª–∏–≥–æ–Ω**.

–í–æ—Ç **3 —É—Ä–æ–≤–Ω—è —Å–ª–æ–∂–Ω–æ—Å—Ç–∏** —Å—Ç–µ–Ω–¥–∞, –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–æ–≥–æ, —Å–∫–æ–ª—å–∫–æ —É –≤–∞—Å —Ä–µ—Å—É—Ä—Å–æ–≤ –∏ –≤—Ä–µ–º–µ–Ω–∏.

* * *

### –£—Ä–æ–≤–µ–Ω—å 1: ¬´–ë–æ–π –≤ —Ç–µ–ª–µ—Ñ–æ–Ω–Ω–æ–π –±—É–¥–∫–µ¬ª (Network Namespaces)

_–î–ª—è —Ç–µ—Ö, —É –∫–æ–≥–æ Linux-–Ω–æ—É—Ç–±—É–∫ –∏ 5 –º–∏–Ω—É—Ç –≤—Ä–µ–º–µ–Ω–∏._

–ú—ã –Ω–µ –±—É–¥–µ–º –ø–æ–¥–Ω–∏–º–∞—Ç—å –≤–∏—Ä—Ç—É–∞–ª–∫–∏, –∞ —Å–æ–∑–¥–∞–¥–∏–º –≤–∏—Ä—Ç—É–∞–ª—å–Ω—É—é —Å–µ—Ç—å –ø—Ä—è–º–æ –≤–Ω—É—Ç—Ä–∏ –≤–∞—à–µ–≥–æ —è–¥—Ä–∞. –≠—Ç–æ –±—ã—Å—Ç—Ä–æ –∏ –±–µ—Å–ø–ª–∞—Ç–Ω–æ –ø–æ —Ä–µ—Å—É—Ä—Å–∞–º.

**–¢–æ–ø–æ–ª–æ–≥–∏—è:** `veth0` (Client) \<---\> `veth1` (Server)

**–°–∫—Ä–∏–ø—Ç —Å–æ–∑–¥–∞–Ω–∏—è —Å—Ç–µ–Ω–¥–∞:**

```
# 1. –°–æ–∑–¥–∞–µ–º –¥–≤–∞ –Ω–µ–π–º—Å–ø–µ–π—Å–∞ (–∫–∞–∫ –¥–≤–∞ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Å–µ—Ä–≤–µ—Ä–∞)
sudo ip netns add client
sudo ip netns add server

# 2. –°–æ–∑–¥–∞–µ–º "–≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π –ø–∞—Ç—á-–∫–æ—Ä–¥" (veth pair)
sudo ip link add veth-client type veth peer name veth-server

# 3. –í—Ç—ã–∫–∞–µ–º –∫–æ–Ω—Ü—ã –∫–∞–±–µ–ª—è –≤ –Ω–µ–π–º—Å–ø–µ–π—Å—ã
sudo ip link set veth-client netns client
sudo ip link set veth-server netns server

# 4. –ü–æ–¥–Ω–∏–º–∞–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –∏ –¥–∞–µ–º IP
sudo ip netns exec client ip addr add 10.0.0.1/24 dev veth-client
sudo ip netns exec client ip link set veth-client up
sudo ip netns exec server ip addr add 10.0.0.2/24 dev veth-server
sudo ip netns exec server ip link set veth-server up
sudo ip netns exec server ip link set lo up # –ù–µ –∑–∞–±—É–¥—å—Ç–µ Loopback!

# 5. –í–∫–ª—é—á–∞–µ–º offloading (—á—Ç–æ–±—ã –±—ã–ª–æ –ø–æ—Ö–æ–∂–µ –Ω–∞ –ø—Ä–∞–≤–¥—É)
sudo ip netns exec client ethtool -K veth-client tso on gso on
```

**–ö–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è:** –ó–∞–ø—É—Å–∫–∞–µ–º —Å–µ—Ä–≤–µ—Ä –≤ –æ–¥–Ω–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ:

```
sudo ip netns exec server iperf3 -s
```

–ó–∞–ø—É—Å–∫–∞–µ–º –∫–ª–∏–µ–Ω—Ç–∞ –∏ –ª–æ–º–∞–µ–º —Å–µ—Ç—å –≤ –¥—Ä—É–≥–æ–º:

```
# –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–¥–µ—Ä–∂–∫—É 100–º—Å –Ω–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∫–ª–∏–µ–Ω—Ç–∞
sudo ip netns exec client tc qdisc add dev veth-client root netem delay 100ms

# –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–µ—Å—Ç
sudo ip netns exec client iperf3 -c 10.0.0.2
```

*   **–ü–ª—é—Å—ã:** –ú–≥–Ω–æ–≤–µ–Ω–Ω–æ, –Ω—É–ª–µ–≤–æ–µ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ RAM.
*   **–ú–∏–Ω—É—Å—ã:** –û–±—â–µ–µ —è–¥—Ä–æ. –ï—Å–ª–∏ –≤—ã –ø–æ–º–µ–Ω—è–µ—Ç–µ `sysctl` (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤–∫–ª—é—á–∏—Ç–µ BBR), —ç—Ç–æ –ø—Ä–∏–º–µ–Ω–∏—Ç—Å—è —Å—Ä–∞–∑—É –∫–æ –≤—Å–µ–º. –°–ª–æ–∂–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–∑–Ω–∏—Ü—É –≤–µ—Ä—Å–∏–π —è–¥—Ä–∞ –∏–ª–∏ –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏.

* * *

### –£—Ä–æ–≤–µ–Ω—å 2: ¬´–ó–æ–ª–æ—Ç–æ–π –°—Ç–∞–Ω–¥–∞—Ä—Ç¬ª (Vagrant + VirtualBox)

_–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –≤–∞—Ä–∏–∞–Ω—Ç._

–ù–∞–º –Ω—É–∂–Ω–∞ **—á–µ—Å—Ç–Ω–∞—è** —Ç–æ–ø–æ–ª–æ–≥–∏—è —Å –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä–æ–º –ø–æ—Å–µ—Ä–µ–¥–∏–Ω–µ, —á—Ç–æ–±—ã —ç–º—É–ª–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∞–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä–Ω–µ—Ç. **–°—Ö–µ–º–∞:** `Client` \<---(LAN 1)---\> `Router` \<---(LAN 2)---\> `Server`

–ü–æ—á–µ–º—É —Ç–∞–∫? –ü–æ—Ç–æ–º—É —á—Ç–æ `tc netem` (—à–µ–π–ø–µ—Ä) –ª—É—á—à–µ –≤—Å–µ–≥–æ —Å—Ç–∞–≤–∏—Ç—å –Ω–∞ `Router`, —á—Ç–æ–±—ã –æ–Ω –±—ã–ª "—á–µ—Ä–Ω—ã–º —è—â–∏–∫–æ–º" –¥–ª—è Client –∏ Server, –∫–∞–∫ –≤ –∂–∏–∑–Ω–∏.

**–§–∞–π–ª `Vagrantfile` (—Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ –≤ –ø—É—Å—Ç—É—é –ø–∞–ø–∫—É –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ `vagrant up`):**

```
Vagrant.configure("2") do |config|
  config.vm.box = "ubuntu/jammy64" # Ubuntu 22.04 LTS

  # --- SERVER (Receiver) ---
  config.vm.define "server" do |server|
    server.vm.network "private_network", ip: "192.168.50.10", virtualbox__intnet: "lan_server"
    server.vm.provision "shell", inline: <<-SHELL
      ip route del default
      ip route add default via 192.168.50.1 # –®–ª—é–∑ - —ç—Ç–æ Router
      apt-get update && apt-get install -y iperf3 iproute2 tcpdump
    SHELL
  end

  # --- ROUTER (The Middlebox) ---
  config.vm.define "router" do |router|
    # –î–≤–µ —Å–µ—Ç–µ–≤—ã–µ –∫–∞—Ä—Ç—ã: –æ–¥–Ω–∞ –∫ —Å–µ—Ä–≤–µ—Ä—É, –æ–¥–Ω–∞ –∫ –∫–ª–∏–µ–Ω—Ç—É
    router.vm.network "private_network", ip: "192.168.50.1", virtualbox__intnet: "lan_server"
    router.vm.network "private_network", ip: "192.168.60.1", virtualbox__intnet: "lan_client"
    
    router.vm.provision "shell", inline: <<-SHELL
      sysctl -w net.ipv4.ip_forward=1 # –í–∫–ª—é—á–∞–µ–º —Ä–æ–ª—å —Ä–æ—É—Ç–µ—Ä–∞
      apt-get update && apt-get install -y iperf3 iproute2 tcpdump
    SHELL
  end

  # --- CLIENT (Sender) ---
  config.vm.define "client" do |client|
    client.vm.network "private_network", ip: "192.168.60.10", virtualbox__intnet: "lan_client"
    client.vm.provision "shell", inline: <<-SHELL
      ip route del default
      ip route add default via 192.168.60.1 # –®–ª—é–∑ - —ç—Ç–æ Router
      apt-get update && apt-get install -y iperf3 iproute2 tcpdump bpfcc-tools
    SHELL
  end
end
```

**–ö–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è:**

1.  `vagrant ssh router` -\> —Ç—É—Ç –ø—Ä–∏–º–µ–Ω—è–µ–º `tc qdisc ... netem delay ...`
2.  `vagrant ssh server` -\> –∑–∞–ø—É—Å–∫–∞–µ–º `iperf3 -s`
3.  `vagrant ssh client` -\> –∑–∞–ø—É—Å–∫–∞–µ–º —Ç–µ—Å—Ç—ã.
    
*   **–ü–ª—é—Å—ã:** –ü–æ–ª–Ω–∞—è –∏–∑–æ–ª—è—Ü–∏—è —è–¥–µ—Ä (–º–æ–∂–Ω–æ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ –≤–∫–ª—é—á–∏—Ç—å BBR, –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ CUBIC). –ß–µ—Å—Ç–Ω–∞—è –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è.
*   **–ú–∏–Ω—É—Å—ã:** –ù—É–∂–Ω–æ ~4-6 –ì–ë RAM.

* * *

### –£—Ä–æ–≤–µ–Ω—å 3: ¬´High-Load Pro¬ª (–î–≤–∞ —Ñ–∏–∑–∏—á–µ—Å–∫–∏—Ö —Å–µ—Ä–≤–µ—Ä–∞ + 10G –∫–∞—Ä—Ç–∞)

_–ï—Å–ª–∏ –≤—ã —Ä–µ–∞–ª—å–Ω–æ –ø–∏—à–µ—Ç–µ –¥—Ä–∞–π–≤–µ—Ä—ã –∏–ª–∏ —Ç—é–Ω–∏—Ç–µ –ø–æ–¥ 10-100 –ì–±–∏—Ç._

–í–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏—è –≤—Ä–µ—Ç. –ì–∏–ø–µ—Ä–≤–∏–∑–æ—Ä (KVM/VirtualBox) –≤–Ω–æ—Å–∏—Ç —Å–≤–æ–∏ –∑–∞–¥–µ—Ä–∂–∫–∏ –∏ –±–∞—Ç—á–∏–Ω–≥ –ø–∞–∫–µ—Ç–æ–≤. –ú–∏–∫—Ä–æ–±–µ—Ä—Å—Ç—ã –Ω–∞ 10G –≤—ã –≤ –≤–∏—Ä—Ç—É–∞–ª–∫–µ –Ω–µ —É–≤–∏–¥–∏—Ç–µ. –í–∞–º –Ω—É–∂–Ω—ã –¥–≤–∞ –ª—é–±—ã—Ö —Å—Ç–∞—Ä—ã—Ö –ü–ö/—Å–µ—Ä–≤–µ—Ä–∞, —Å–æ–µ–¥–∏–Ω–µ–Ω–Ω—ã–µ –ø–∞—Ç—á-–∫–æ—Ä–¥–æ–º –Ω–∞–ø—Ä—è–º—É—é (–±–µ–∑ —Å–≤–∏—Ç—á–∞).

**–°—Ç–µ–Ω–¥:**

*   Machine A (Generator): Linux, `pktgen-dpdk` –∏–ª–∏ `Trex` (Cisco).
*   Machine B (DUT - Device Under Test): –í–∞—à —Å–µ—Ä–≤–µ—Ä —Å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º.

* * *

### –ú–æ—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è –¥–ª—è –æ–±—É—á–µ–Ω–∏—è

–ë–µ—Ä–∏—Ç–µ **–£—Ä–æ–≤–µ–Ω—å 2 (Vagrant)**.

–û–Ω –ø–æ–∑–≤–æ–ª—è–µ—Ç "—á–µ—Å—Ç–Ω–æ" –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å BBR, –±–µ–∑–æ–ø–∞—Å–Ω–æ –ª–æ–º–∞—Ç—å —Å–µ—Ç—å —á–µ—Ä–µ–∑ `tc` –Ω–∞ —Ä–æ—É—Ç–µ—Ä–µ –∏ –≤–∏–¥–µ—Ç—å, –∫–∞–∫ TCP –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è. –ü–ª—é—Å, –≤—ã –º–æ–∂–µ—Ç–µ –ø–æ—Å—Ç–∞–≤–∏—Ç—å `bpfcc-tools` –Ω–∞ –∫–ª–∏–µ–Ω—Ç–∞ –∏ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∞—Ç—å—Å—è —Å eBPF, –Ω–µ –±–æ—è—Å—å –ø–æ–≤–µ—Å–∏—Ç—å —Å–≤–æ–π —Ä–∞–±–æ—á–∏–π –Ω–æ—É—Ç–±—É–∫.

**–ù–∞—á–∏–Ω–∞–µ–º —Å–æ–±–∏—Ä–∞—Ç—å Vagrant?**

## Prompt:
VMware —É –º–µ–Ω—è

## Response:
–ë–µ–∑ –ø—Ä–æ–±–ª–µ–º. –° VMware –¥–∞–∂–µ –ª—É—á—à–µ ‚Äî —É –Ω–µ–≥–æ —Å–µ—Ç–µ–≤–æ–π —Å—Ç–µ–∫ (vSwitch) —á–∞—Å—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–µ–µ –∏ –±—ã—Å—Ç—Ä–µ–µ, —á–µ–º —É VirtualBox, —á—Ç–æ –Ω–∞–º –Ω–∞ —Ä—É–∫—É –¥–ª—è —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏.

–¢–∞–∫ –∫–∞–∫ Vagrant —Å VMware —Ç—Ä–µ–±—É–µ—Ç –ø–ª–∞—Ç–Ω—ã–π –ø–ª–∞–≥–∏–Ω (vagrant-vmware-desktop) –∏ –ª–∏—à–Ω—é—é –≤–æ–∑–Ω—é —Å –¥—Ä–∞–π–≤–µ—Ä–∞–º–∏, –º—ã –ø–æ–π–¥–µ–º –ø–æ **–ø—É—Ç–∏ –∏–Ω–∂–µ–Ω–µ—Ä–∞**: —Å–æ–±–µ—Ä–µ–º —Å—Ç–µ–Ω–¥ –≤—Ä—É—á–Ω—É—é. –≠—Ç–æ –∑–∞–π–º–µ—Ç 15 –º–∏–Ω—É—Ç, –∑–∞—Ç–æ –≤—ã –±—É–¥–µ—Ç–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–ø–æ–ª–æ–≥–∏—é.

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –°—Ç–µ–Ω–¥–∞ (VMware Edition)

–ù–∞–º –Ω—É–∂–Ω–æ —ç–º—É–ª–∏—Ä–æ–≤–∞—Ç—å —Ç—É –∂–µ —Å—Ö–µ–º—É: `[Client] <--(LAN 1)--> [Router] <--(LAN 2)--> [Server]`

–í VMware –¥–ª—è —ç—Ç–æ–≥–æ –º—ã –±—É–¥–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **LAN Segments** (–µ—Å–ª–∏ —É –≤–∞—Å Workstation Pro) –∏–ª–∏ –∫–∞—Å—Ç–æ–º–Ω—ã–µ **VMnet** (–µ—Å–ª–∏ Player).

* * *

### –®–∞–≥ 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö —Å–µ—Ç–µ–π

1.  –û—Ç–∫—Ä–æ–π—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ª—é–±–æ–π –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω—ã (–∏–ª–∏ Global Settings).
2.  –ù–∞–π–¥–∏—Ç–µ **LAN Segments** (–°–µ–≥–º–µ–Ω—Ç—ã –ª–æ–∫–∞–ª—å–Ω–æ–π —Å–µ—Ç–∏).
    *   _–ï—Å–ª–∏ –∏—Ö –Ω–µ—Ç (VMware Player):_ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ VMnet2 –∏ VMnet3, –æ—Ç–∫–ª—é—á–∏–≤ –≤ –Ω–∏—Ö DHCP —á–µ—Ä–µ–∑ `Virtual Network Editor`.
3.  –°–æ–∑–¥–∞–π—Ç–µ –¥–≤–∞ —Å–µ–≥–º–µ–Ω—Ç–∞:
    *   `Link_Client_Router`
    *   `Link_Router_Server`

* * *

### –®–∞–≥ 2: –°–æ–∑–¥–∞–Ω–∏–µ –í–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö –ú–∞—à–∏–Ω

–í–∞–º –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è –æ–¥–∏–Ω ISO –æ–±—Ä–∞–∑ **Ubuntu Server 22.04 (–∏–ª–∏ 24.04)**. –°—Ç–∞–≤—å—Ç–µ –º–∏–Ω–∏–º–∞–ª—å–Ω—É—é –≤–µ—Ä—Å–∏—é (Minimized), —á—Ç–æ–±—ã –Ω–µ —Ç—Ä–∞—Ç–∏—Ç—å —Ä–µ—Å—É—Ä—Å—ã.

#### 1\. VM "Router" (–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π —É–∑–µ–ª)

–≠—Ç–æ —Å–∞–º–∞—è –≤–∞–∂–Ω–∞—è –º–∞—à–∏–Ω–∞. –£ –Ω–µ—ë –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å **3 —Å–µ—Ç–µ–≤—ã—Ö –∞–¥–∞–ø—Ç–µ—Ä–∞**:

*   **Adapter 1:** `NAT` (–ß—Ç–æ–±—ã —Å–∞–º —Ä–æ—É—Ç–µ—Ä –∏–º–µ–ª –¥–æ—Å—Ç—É–ø –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç –∏ –º—ã –º–æ–≥–ª–∏ —Å—Ç–∞–≤–∏—Ç—å –ø–∞–∫–µ—Ç—ã).
*   **Adapter 2:** `LAN Segment` -\> –í—ã–±–∏—Ä–∞–µ–º `Link_Client_Router`.
*   **Adapter 3:** `LAN Segment` -\> –í—ã–±–∏—Ä–∞–µ–º `Link_Router_Server`.

_–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Ubuntu, –Ω–∞–∑–æ–≤–∏—Ç–µ —Ö–æ—Å—Ç `router`._

#### 2\. VM "Client" (–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä)

*   **Adapter 1:** `LAN Segment` -\> `Link_Client_Router`.
*   _(–í–∞–∂–Ω–æ)_ –ü–æ–∫–∞ –Ω–µ –¥–æ–±–∞–≤–ª—è–π—Ç–µ NAT –∞–¥–∞–ø—Ç–µ—Ä. –ú—ã –Ω–∞—Å—Ç—Ä–æ–∏–º –∏–Ω—Ç–µ—Ä–Ω–µ—Ç —á–µ—Ä–µ–∑ –†–æ—É—Ç–µ—Ä, —á—Ç–æ–±—ã —ç—Ç–æ –±—ã–ª–æ —á–µ—Å—Ç–Ω–æ.

#### 3\. VM "Server" (–ü—Ä–∏–µ–º–Ω–∏–∫)

*   **Adapter 1:** `LAN Segment` -\> `Link_Router_Server`.

* * *

### –®–∞–≥ 3: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ—Ç–∏ –≤–Ω—É—Ç—Ä–∏ Linux

–¢–µ–ø–µ—Ä—å –ø—Ä–µ–≤—Ä–∞—â–∞–µ–º —ç—Ç–∏ VM –≤ –±–æ–µ–≤–æ–π —Å—Ç–µ–Ω–¥. –õ–æ–≥–∏–Ω–∏–º—Å—è –≤ –∫–æ–Ω—Å–æ–ª–∏.

#### A. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ ROUTER

–ù–∞–º –Ω—É–∂–Ω–æ –≤–∫–ª—é—á–∏—Ç—å —Ñ–æ—Ä–≤–∞—Ä–¥–∏–Ω–≥ –ø–∞–∫–µ—Ç–æ–≤ –∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–¥—Ä–µ—Å–∞.

1.  **–£–∑–Ω–∞–µ–º –∏–º–µ–Ω–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤:** `ip a`. –û–±—ã—á–Ω–æ `ens33` (NAT), `ens34` (LAN1), `ens35` (LAN2). –ü—É—Å—Ç—å –±—É–¥–µ—Ç —Ç–∞–∫ –¥–ª—è –ø—Ä–∏–º–µ—Ä–∞.
2.  **–ù–∞–∑–Ω–∞—á–∞–µ–º IP –∏ –≤–∫–ª—é—á–∞–µ–º –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—é:**
    
```
# 1. –ù–∞–∑–Ω–∞—á–∞–µ–º IP –Ω–∞ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã
sudo ip addr add 192.168.60.1/24 dev ens34
sudo ip link set ens34 up

sudo ip addr add 192.168.50.1/24 dev ens35
sudo ip link set ens35 up

# 2. –í–∫–ª—é—á–∞–µ–º —Ä–æ–ª—å —Ä–æ—É—Ç–µ—Ä–∞ (Forwarding)
sudo sysctl -w net.ipv4.ip_forward=1

# 3. –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º NAT (Masquerade), —á—Ç–æ–±—ã –ö–ª–∏–µ–Ω—Ç –∏ –°–µ—Ä–≤–µ—Ä –º–æ–≥–ª–∏ –∫–∞—á–∞—Ç—å –ø–∞–∫–µ—Ç—ã —á–µ—Ä–µ–∑ –†–æ—É—Ç–µ—Ä
# (–ó–∞–º–µ–Ω–∏—Ç–µ ens33 –Ω–∞ –≤–∞—à –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å, –∫–æ—Ç–æ—Ä—ã–π —Å–º–æ—Ç—Ä–∏—Ç –≤ –ò–Ω—Ç–µ—Ä–Ω–µ—Ç/NAT VMware)
sudo iptables -t nat -A POSTROUTING -o ens33 -j MASQUERADE
```

_–ü—Ä–æ–≤–µ—Ä–∫–∞:_ –ü—Ä–æ–ø–∏–Ω–≥—É–π—Ç–µ `8.8.8.8` —Å —Ä–æ—É—Ç–µ—Ä–∞. –î–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å.

#### B. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ SERVER

–£ –Ω–µ–≥–æ –Ω–µ—Ç –ø—Ä—è–º–æ–≥–æ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞, —Ç–æ–ª—å–∫–æ –∫–∞–±–µ–ª—å –∫ —Ä–æ—É—Ç–µ—Ä—É.

```
# 1. –°—Ç–∞–≤–∏–º IP
sudo ip addr add 192.168.50.10/24 dev ens33
sudo ip link set ens33 up

# 2. –£–∫–∞–∑—ã–≤–∞–µ–º —à–ª—é–∑ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (–Ω–∞—à –†–æ—É—Ç–µ—Ä)
sudo ip route add default via 192.168.50.1

# 3. –ü—Ä–æ–ø–∏—Å—ã–≤–∞–µ–º DNS (–∏–Ω–∞—á–µ apt –Ω–µ –∑–∞—Ä–∞–±–æ—Ç–∞–µ—Ç)
echo "nameserver 8.8.8.8" | sudo tee /etc/resolv.conf
```

_–ü—Ä–æ–≤–µ—Ä–∫–∞:_ `ping 8.8.8.8`. –ï—Å–ª–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç ‚Äî –ø–æ–∑–¥—Ä–∞–≤–ª—è—é, –≤–∞—à —Ä–æ—É—Ç–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ –Ω–∞—Å—Ç–æ—è—â–∏–π —à–ª—é–∑. _–£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–æ—Ñ—Ç–∞:_ `sudo apt update && sudo apt install -y iperf3 iproute2 tcpdump`

#### C. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ CLIENT

–ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ —Å–µ—Ä–≤–µ—Ä—É, –Ω–æ –¥—Ä—É–≥–∞—è –ø–æ–¥—Å–µ—Ç—å.

```
# 1. –°—Ç–∞–≤–∏–º IP
sudo ip addr add 192.168.60.10/24 dev ens33
sudo ip link set ens33 up

# 2. –®–ª—é–∑
sudo ip route add default via 192.168.60.1

# 3. DNS
echo "nameserver 8.8.8.8" | sudo tee /etc/resolv.conf
```

_–ü—Ä–æ–≤–µ—Ä–∫–∞:_ `ping 8.8.8.8`. _–£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–æ—Ñ—Ç–∞:_ `sudo apt update && sudo apt install -y iperf3 iproute2 tcpdump bpfcc-tools`

* * *

### –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ –°—Ç–µ–Ω–¥–∞

–¢–µ–ø–µ—Ä—å —É –Ω–∞—Å –µ—Å—Ç—å –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–∏—è. –¢—Ä–∞—Ñ–∏–∫ –æ—Ç –ö–ª–∏–µ–Ω—Ç–∞ –∫ –°–µ—Ä–≤–µ—Ä—É **–æ–±—è–∑–∞–Ω** –ø—Ä–æ–π—Ç–∏ —á–µ—Ä–µ–∑ –†–æ—É—Ç–µ—Ä.

1.  **–ù–∞ –°–µ—Ä–≤–µ—Ä–µ:** –ó–∞–ø—É—Å–∫–∞–µ–º iperf –≤ —Ä–µ–∂–∏–º–µ —Å–µ—Ä–≤–µ—Ä–∞.
    ```
    iperf3 -s
    ```
2.  **–ù–∞ –ö–ª–∏–µ–Ω—Ç–µ:** –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–µ—Å—Ç —Å–∫–æ—Ä–æ—Å—Ç–∏.
    ```
    iperf3 -c 192.168.50.10
    ```
    _–í—ã –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –ì–∏–≥–∞–±–∏—Ç (–∏–ª–∏ –±–æ–ª—å—à–µ, —Ç.–∫. VMware –æ–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ—Ç —Ç—Ä–∞—Ñ–∏–∫ –≤–Ω—É—Ç—Ä–∏ –ø–∞–º—è—Ç–∏)._

* * *

### –®–∞–≥ 5: –í–∞—à–∞ –ø–µ—Ä–≤–∞—è –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞—è (The Lag)

–¢–µ–ø–µ—Ä—å —Å–∞–º–æ–µ –≤–∫—É—Å–Ω–æ–µ. –ò–º–∏—Ç–∏—Ä—É–µ–º –ø–ª–æ—Ö–æ–π –∏–Ω—Ç–µ—Ä–Ω–µ—Ç –Ω–∞ –†–æ—É—Ç–µ—Ä–µ.

1.  –ó–∞–π–¥–∏—Ç–µ –Ω–∞ **Router**.
2.  –î–æ–±–∞–≤—å—Ç–µ –∑–∞–¥–µ—Ä–∂–∫—É –Ω–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å, —Å–º–æ—Ç—Ä—è—â–∏–π –≤ —Å—Ç–æ—Ä–æ–Ω—É –∫–ª–∏–µ–Ω—Ç–∞ (`ens34` –≤ –Ω–∞—à–µ–º –ø—Ä–∏–º–µ—Ä–µ, —Ç–æ—Ç –∫–æ—Ç–æ—Ä—ã–π `192.168.60.1`).
    ```
    # –î–æ–±–∞–≤–ª—è–µ–º 100–º—Å –∑–∞–¥–µ—Ä–∂–∫–∏ (—Ç—É–¥–∞-–æ–±—Ä–∞—Ç–Ω–æ –±—É–¥–µ—Ç 200–º—Å)
    sudo tc qdisc add dev ens34 root netem delay 100ms
    ```
3.  –í–µ—Ä–Ω–∏—Ç–µ—Å—å –Ω–∞ **Client** –∏ —Å–Ω–æ–≤–∞ –∑–∞–ø—É—Å—Ç–∏—Ç–µ `iperf3 -c 192.168.50.10`. _–ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ, –∫–∞–∫ —É–ø–∞–ª–∞ —Å–∫–æ—Ä–æ—Å—Ç—å (Throughput) –∏–∑-–∑–∞ —Ä–æ—Å—Ç–∞ RTT, —Ö–æ—Ç—è –∫–∞–Ω–∞–ª –æ—Å—Ç–∞–ª—Å—è —à–∏—Ä–æ–∫–∏–º. –≠—Ç–æ —Ñ–∏–∑–∏–∫–∞ TCP._
4.  –ß—Ç–æ–±—ã —É–±—Ä–∞—Ç—å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –Ω–∞ —Ä–æ—É—Ç–µ—Ä–µ:
    ```
    sudo tc qdisc del dev ens34 root
    ```

**–°—Ç–µ–Ω–¥ –≥–æ—Ç–æ–≤.** –°–æ–æ–±—â–∏—Ç–µ, –∫–æ–≥–¥–∞ –≤—Å–µ –∑–∞—Ä–∞–±–æ—Ç–∞–µ—Ç (–ø–∏–Ω–≥–∏ —Ö–æ–¥—è—Ç —Å–∫–≤–æ–∑—å —Ä–æ—É—Ç–µ—Ä), –∏ –º—ã –ø–µ—Ä–µ–π–¥–µ–º –∫ Module 4.



---
Powered by [Gemini Exporter](https://www.ai-chat-exporter.com)
